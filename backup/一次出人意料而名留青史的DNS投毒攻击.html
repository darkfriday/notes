<!doctype html>
<html lang="zh" data-hairline="true" data-theme="light"><head><meta charSet="utf-8"/><title data-react-helmet="true">一次出人意料而名留青史的DNS投毒攻击 - 知乎</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/><meta name="renderer" content="webkit"/><meta name="force-rendering" content="webkit"/><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="google-site-verification" content="FTeR0c8arOPKh8c5DYh_9uu98_zJbaWw53J-Sch9MTg"/><meta data-react-helmet="true" name="keywords" content="DNS,DNS 劫持,DNS 解析"/><meta data-react-helmet="true" name="description" content="作者：卫剑钒 2008年7月，在互联网上发生了一件极具历史意义的DNS安全事件，该事件一经发布，立即震动了整个互联网，因为，自1983年DNS被发明以来，人们还从未遇到过这类影响深远而易于实现的攻击。Cricket Liu, …"/><meta data-react-helmet="true" property="og:title" content="一次出人意料而名留青史的DNS投毒攻击"/><meta data-react-helmet="true" property="og:url" content="https://zhuanlan.zhihu.com/p/92899876"/><meta data-react-helmet="true" property="og:description" content="作者：卫剑钒 2008年7月，在互联网上发生了一件极具历史意义的DNS安全事件，该事件一经发布，立即震动了整个互联网，因为，自1983年DNS被发明以来，人们还从未遇到过这类影响深远而易于实现的攻击。Cricket Liu, …"/><meta data-react-helmet="true" property="og:image" content="https://pica.zhimg.com/v2-a6eb73389aaeaefde8dfa3bb8c8bbe77_720w.jpg?source=172ae18b"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:site_name" content="知乎专栏"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-152.a53ae37b.png" sizes="152x152"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-120.bbce8f18.png" sizes="120x120"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-76.cbade8f9.png" sizes="76x76"/><link data-react-helmet="true" rel="apple-touch-icon" href="https://static.zhihu.com/heifetz/assets/apple-touch-icon-60.8f6c52aa.png" sizes="60x60"/><link crossorigin="" rel="shortcut icon" type="image/x-icon" href="https://static.zhihu.com/heifetz/favicon.ico"/><link crossorigin="" rel="search" type="application/opensearchdescription+xml" href="https://static.zhihu.com/heifetz/search.xml" title="知乎"/><link rel="dns-prefetch" href="//static.zhimg.com"/><link rel="dns-prefetch" href="//pic1.zhimg.com"/><link rel="dns-prefetch" href="//pic2.zhimg.com"/><link rel="dns-prefetch" href="//pic3.zhimg.com"/><link rel="dns-prefetch" href="//pic4.zhimg.com"/><style>
.u-safeAreaInset-top {
  height: constant(safe-area-inset-top) !important;
  height: env(safe-area-inset-top) !important;
  
}
.u-safeAreaInset-bottom {
  height: constant(safe-area-inset-bottom) !important;
  height: env(safe-area-inset-bottom) !important;
  
}
</style><link href="https://static.zhihu.com/heifetz/column.app.216a26f4.86022b3c9b25405f39ab.css" crossorigin="" rel="stylesheet"/><script nonce="cc7ca8f5-8718-4bbe-975e-630024d137b2">!function(){"use strict";!function(e,n){var r,t,a,c,o,i=[];function s(e){return function(){i.push([e,arguments])}}function u(e){var n=e;if(!(e instanceof Error||e instanceof ErrorEvent||e instanceof DOMError||e instanceof DOMException)){var r=e.message||e.reason;n=Error(r)}Raven.captureException(n)}n.Raven={captureException:s("captureException"),captureMessage:s("captureMessage"),captureBreadcrumb:s("captureBreadcrumb")},n.addEventListener("unhandledrejection",u),n.addEventListener("error",u,!0),r=e.src,t=e,a=function(){i.forEach(function(e){var n;(n=Raven)[e[0]].apply(n,e[1])}),n.removeEventListener("unhandledrejection",u),n.removeEventListener("error",u,!0)},c=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("script")).crossOrigin=t.crossOrigin,o.dataset.sentryConfig=t["data-sentry-config"],o.onload=a,o.src=r,c.appendChild(o)}({"defer":true,"crossOrigin":"anonymous","src":"https://unpkg.zhimg.com/@cfe/sentry-script@1.3.0/dist/init.js","data-sentry-config":"{\"dsn\":\"https://2d8d764432cc4f6fb3bc78ab9528299d@crash2.zhihu.com/1224\",\"sampleRate\":0.1,\"release\":\"3209-5a08d4d6\",\"ignoreErrorNames\":[\"NetworkError\",\"SecurityError\"],\"ignoreErrorsPreset\":\"ReactApp\"}"},window)}();
</script></head><body class="WhiteBg-body"><div id="root"><div class="App"><div class="LoadingBar"></div><div><span style="position:absolute;top:-10000px;left:-10000px" role="log" aria-live="polite"></span></div><main role="main" class="App-main"><div class="Post-content" data-zop-usertoken="{&quot;userToken&quot;:&quot;&quot;}" data-zop="{&quot;authorName&quot;:&quot;卫sir&quot;,&quot;itemId&quot;:92899876,&quot;title&quot;:&quot;一次出人意料而名留青史的DNS投毒攻击&quot;,&quot;type&quot;:&quot;article&quot;}"><div class="ColumnPageHeader-Wrapper"><div><div class="Sticky ColumnPageHeader"><div class="ColumnPageHeader-content"><a href="//www.zhihu.com" aria-label="知乎"><style data-emotion-css="1hlrcxk">.css-1hlrcxk{-webkit-transition-property:fill;transition-property:fill;-webkit-transition-duration:0.25s;transition-duration:0.25s;-webkit-transition-timing-function:ease-in;transition-timing-function:ease-in;}</style><svg viewBox="0 0 64 30" fill="#0066FF" width="64" height="30" class="css-1hlrcxk"><path d="M29.05 4.582H16.733V25.94h3.018l.403 2.572 4.081-2.572h4.815V4.582zm-5.207 18.69l-2.396 1.509-.235-1.508h-1.724V7.233h6.78v16.04h-2.425zM14.46 14.191H9.982c0-.471.033-.954.039-1.458v-5.5h5.106V5.935a1.352 1.352 0 0 0-.404-.957 1.378 1.378 0 0 0-.968-.396H5.783c.028-.088.056-.177.084-.255.274-.82 1.153-3.326 1.153-3.326a4.262 4.262 0 0 0-2.413.698c-.57.4-.912.682-1.371 1.946-.532 1.453-.997 2.856-1.31 3.693C1.444 8.674.28 11.025.28 11.025a5.85 5.85 0 0 0 2.52-.61c1.119-.593 1.679-1.502 2.054-2.883l.09-.3h2.334v5.5c0 .5-.045.982-.073 1.46h-4.12c-.71 0-1.39.278-1.893.775a2.638 2.638 0 0 0-.783 1.874h6.527a17.717 17.717 0 0 1-.778 3.649 16.796 16.796 0 0 1-3.012 5.273A33.104 33.104 0 0 1 0 28.74s3.13 1.175 5.425-.954c1.388-1.292 2.631-3.814 3.23-5.727a28.09 28.09 0 0 0 1.12-5.229h5.967v-1.37a1.254 1.254 0 0 0-.373-.899 1.279 1.279 0 0 0-.909-.37z"></path><path d="M11.27 19.675l-2.312 1.491 5.038 7.458a6.905 6.905 0 0 0 .672-2.218 3.15 3.15 0 0 0-.28-2.168l-3.118-4.563zM51.449 15.195V5.842c4.181-.205 7.988-.405 9.438-.483l.851-.05c.387-.399.885-2.395.689-3.021-.073-.25-.213-.666-.638-.555a33.279 33.279 0 0 1-4.277.727c-2.766.321-3.97.404-7.804.682-6.718.487-12.709.72-12.709.72a2.518 2.518 0 0 0 .788 1.834 2.567 2.567 0 0 0 1.883.706c2.278-.095 5.598-.25 8.996-.41v9.203h-12.78c0 .703.281 1.377.783 1.874a2.69 2.69 0 0 0 1.892.777h10.105v7.075c0 .887-.464 1.192-1.231 1.214h-3.92a4.15 4.15 0 0 0 .837 1.544 4.2 4.2 0 0 0 1.403 1.067 6.215 6.215 0 0 0 2.71.277c1.36-.066 2.967-.826 2.967-3.57v-7.607h11.28c.342 0 .67-.135.91-.374.242-.239.378-.563.378-.902v-1.375H51.449z"></path><path d="M42.614 8.873a2.304 2.304 0 0 0-1.508-.926 2.334 2.334 0 0 0-1.727.405l-.376.272 4.255 5.85 2.24-1.62-2.884-3.98zM57.35 8.68l-3.125 4.097 2.24 1.663 4.517-5.927-.375-.277a2.32 2.32 0 0 0-1.722-.452 2.327 2.327 0 0 0-1.536.896z"></path></svg></a><i class="ColumnPageHeader-Line"></i><div class="ColumnPageHeader-Title"><div class="ColumnPageHeader-TitleName"><span class="ColumnPageHeader-TitleMeta">首发于</span><a class="ColumnLink ColumnPageHeader-TitleColumn" href="//www.zhihu.com/column/c_1145396270574198784">关于人和科技的思考</a></div></div><div class="ColumnPageHeader-Button"><button type="button" class="Button ColumnPageHeader-WriteButton Button--blue"><svg class="Zi Zi--EditSurround" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><path d="M4 6a2 2 0 0 1 2-2h5.75a.25.25 0 0 1 .25.25v1.5a.25.25 0 0 1-.25.25h-5.5a.25.25 0 0 0-.25.25v11.5c0 .138.112.25.25.25h11.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 1 .25-.25h1.5a.25.25 0 0 1 .25.25V18a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6z" fill-rule="evenodd" clip-rule="evenodd"></path><path d="M18.293 1.293a1 1 0 0 1 1.414 0l3 3a1 1 0 0 1 0 1.414l-10 10A1 1 0 0 1 12 16H9a1 1 0 0 1-1-1v-3a1 1 0 0 1 .293-.707l10-10zm-8.22 11.048a.25.25 0 0 0-.073.177v1.232c0 .138.112.25.25.25h1.232a.25.25 0 0 0 .177-.073l8.75-8.75a.25.25 0 0 0 0-.354l-1.232-1.232a.25.25 0 0 0-.354 0l-8.75 8.75z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>写文章</button></div></div><div class="ColumnPageHeader-profile"><div><button type="button" class="Button AppHeader-login Button--blue">登录</button></div></div></div></div></div><img class="TitleImage" src="https://pica.zhimg.com/v2-a6eb73389aaeaefde8dfa3bb8c8bbe77_1440w.jpg?source=172ae18b" alt="一次出人意料而名留青史的DNS投毒攻击"/><article class="Post-Main Post-NormalMain" tabindex="-1"><header class="Post-Header"><h1 class="Post-Title">一次出人意料而名留青史的DNS投毒攻击</h1><div class="Post-Author"><div class="AuthorInfo" itemProp="author" itemscope="" itemType="http://schema.org/Person"><div class="AuthorInfo"><meta itemProp="name" content="卫sir"/><meta itemProp="image" content="https://pica.zhimg.com/v2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b"/><meta itemProp="url" content="https://www.zhihu.com/people/wang-ming-12-38"/><meta itemProp="zhihu:followerCount"/><span class="UserLink AuthorInfo-avatarWrapper"><a target="_blank" class="UserLink-link" data-za-detail-view-element_name="User" href="//www.zhihu.com/people/wang-ming-12-38"><img class="Avatar Avatar--round AuthorInfo-avatar" width="38" height="38" src="https://pica.zhimg.com/v2-e80f923f1a8564f080805aeb00d0b55c_xs.jpg?source=172ae18b" srcSet="https://pica.zhimg.com/v2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b 2x" alt="卫sir"/></a></span><div class="AuthorInfo-content"><div class="AuthorInfo-head"><span class="UserLink AuthorInfo-name"><a target="_blank" class="UserLink-link" data-za-detail-view-element_name="User" href="//www.zhihu.com/people/wang-ming-12-38">卫sir</a><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><style data-emotion-css="1cd9gw4">.css-1cd9gw4{margin-left:.3em;}</style><span rel="noopener noreferrer" class="css-1cd9gw4"><style data-emotion-css="139b4gy">.css-139b4gy{height:1em;width:1em;}.css-139b4gy:hover{cursor:pointer;}</style><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--VIP css-139b4gy" fill="currentColor" viewBox="0 0 24 24" width="24" height="24"><defs><linearGradient id="id-3811055512-a" x1="11.015%" x2="87.655%" y1="18.594%" y2="96.14%"><stop offset="0%" stop-color="#F2D9B6"></stop><stop offset="100%" stop-color="#BF8B43"></stop></linearGradient></defs><path fill="url(#id-3811055512-a)" d="M21.351 4.858A3.115 3.115 0 0 1 22.93 7.56v8.88a3.115 3.115 0 0 1-1.578 2.702l-7.774 4.44a3.185 3.185 0 0 1-3.154 0l-7.774-4.44A3.115 3.115 0 0 1 1.07 16.44V7.56c0-1.115.602-2.145 1.578-2.702l7.774-4.44a3.185 3.185 0 0 1 3.154 0l7.774 4.44zm-2.475 1.904L13.16 3.507a2.347 2.347 0 0 0-2.32 0L5.124 6.762a2.283 2.283 0 0 0-1.16 1.982v6.512c0 .817.442 1.573 1.16 1.982l5.716 3.255a2.347 2.347 0 0 0 2.32 0l5.716-3.255a2.283 2.283 0 0 0 1.16-1.982V8.744c0-.817-.442-1.573-1.16-1.982zm-9.874 4.13L12 5.76l2.998 5.131 2.466-2.12v6.343c0 .49-.4.886-.893.886H7.429a.89.89 0 0 1-.893-.887V8.771l2.466 2.12z"></path></svg></span></span></span></div><div class="AuthorInfo-detail"><div class="AuthorInfo-badge"></div></div></div></div></div></div><div role="button" tabindex="0"><span class="Voters"><button type="button" class="Button Button--plain">69 人<!-- -->赞同了该文章</button></span></div></header><div class="Post-RichTextContainer"><style data-emotion-css="1yuhvjn">.css-1yuhvjn{margin-top:16px;}</style><div class="css-1yuhvjn"><style data-emotion-css="3jt6os">.css-3jt6os .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-3jt6os .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-3jt6os .FileLinkCard-info{margin-left:12px;}.css-3jt6os .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-3jt6os .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-3jt6os .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="1wr1m8">.css-1wr1m8 .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-1wr1m8 .LinkCard.new,.css-1wr1m8 .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-1wr1m8 .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-1wr1m8 .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-1wr1m8 .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-1wr1m8 .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-1wr1m8 .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-1wr1m8 .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-1wr1m8 .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-1wr1m8 .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-1wr1m8 .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-1wr1m8 .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-1wr1m8 .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-1wr1m8 .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-1wr1m8 .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-1wr1m8 .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-1wr1m8 .LinkCard.old,.css-1wr1m8 .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-1wr1m8 .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-1wr1m8 .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}</style><style data-emotion-css="hypxot">.css-hypxot .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-hypxot .LinkCard.old,.css-hypxot .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-hypxot .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-hypxot .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-hypxot .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-hypxot .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-hypxot .LinkCard.new,.css-hypxot .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hypxot .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-hypxot .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-hypxot .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-hypxot .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-hypxot .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-hypxot .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-hypxot .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hypxot .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-hypxot .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-hypxot .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-hypxot .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-hypxot .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-hypxot .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-hypxot .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-hypxot .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-hypxot .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-hypxot .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-hypxot .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-hypxot .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-hypxot .FileLinkCard-info{margin-left:12px;}.css-hypxot .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hypxot .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-hypxot .FileLinkCard-source{white-space:pre;}</style><style data-emotion-css="hnrfcf animation-1sh55c5">.css-hnrfcf{word-break:break-word;line-height:1.6;}.css-hnrfcf a.UserLink-link{color:#175199;}.css-hnrfcf a.UserLink-link:hover{border-bottom:1px solid #175199;}.css-hnrfcf lazy[data-lazy-status]{background-color:#F6F6F6;}.css-hnrfcf lazy[data-lazy-status="ok"]{background-color:transparent;-webkit-animation:animation-1sh55c5 0.5s ease-in;animation:animation-1sh55c5 0.5s ease-in;}.css-hnrfcf > *:first-of-type{margin-top:0;}.css-hnrfcf > :last-child{margin-bottom:0;}.css-hnrfcf h1,.css-hnrfcf h2{clear:left;margin-top:calc((1.4em * 2) / 1.2);margin-bottom:calc(1.4em / 1.2);font-size:1.2em;line-height:1.5;font-weight:600;}.css-hnrfcf h3,.css-hnrfcf h4,.css-hnrfcf h5,.css-hnrfcf h6{clear:left;margin-top:calc((1.4em * 1.5) / 1.1);margin-bottom:calc(1.4em / 1.1);font-size:1.1em;line-height:1.5;font-weight:600;}.css-hnrfcf u{-webkit-text-decoration:none;text-decoration:none;border-bottom:1px dashed #808080;}.css-hnrfcf b{font-weight:600;}.css-hnrfcf sup{font-size:0.8em;}.css-hnrfcf sup[data-draft-type='reference']{color:#175199;}.css-hnrfcf a:focus{outline:none;-webkit-transition:box-shadow 0.3s;transition:box-shadow 0.3s;}html[data-focus-visible] .css-hnrfcf a:focus{box-shadow:0 0 0 2px #FFFFFF,0 0 0 4px rgba(0,102,255,0.3);}.css-hnrfcf a.ztext-link,.css-hnrfcf a.internal,.css-hnrfcf a.external{-webkit-text-decoration:none;text-decoration:none;cursor:pointer;border-bottom:1px solid #808080;}.css-hnrfcf a.ztext-link:hover,.css-hnrfcf a.internal:hover,.css-hnrfcf a.external:hover{color:#175199;border-bottom:1px solid #175199;}.css-hnrfcf a.ztext-link > .ellipsis::after,.css-hnrfcf a.internal > .ellipsis::after,.css-hnrfcf a.external > .ellipsis::after{content:'...';}.css-hnrfcf a.ztext-link > .invisible,.css-hnrfcf a.internal > .invisible,.css-hnrfcf a.external > .invisible{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;}.css-hnrfcf a.ztext-link u,.css-hnrfcf a.internal u,.css-hnrfcf a.external u{border:none;}.css-hnrfcf a.member_mention{color:#175199;}.css-hnrfcf a.member_mention:hover{border-bottom:1px solid #175199;}.css-hnrfcf p{margin:1.4em 0;}.css-hnrfcf p.ztext-empty-paragraph{margin:calc((2.8em- (1.4em * 2 + 1.6em)) / 2) 0;}.css-hnrfcf p.ztext-empty-paragraph + .ztext-empty-paragraph{margin:1.4em 0;}.css-hnrfcf hr{margin:4em auto;width:240px;max-width:100%;border:none;border-top:1px solid #D3D3D3;}.css-hnrfcf img[eeimg]{max-width:100%;vertical-align:middle;}.css-hnrfcf img[eeimg="1"]{margin:0 3px;display:inline-block;}.css-hnrfcf img[eeimg="2"]{margin:1.4em 0;display:block;}.css-hnrfcf blockquote{margin:1.4em 0;padding-left:1em;color:#646464;border-left:3px solid #D3D3D3;}.css-hnrfcf ol,.css-hnrfcf ul{margin:1.4em 0;padding:0;}.css-hnrfcf ol ol,.css-hnrfcf ul ol,.css-hnrfcf ol ul,.css-hnrfcf ul ul{margin:0;}.css-hnrfcf ol > ol,.css-hnrfcf ul > ol,.css-hnrfcf ol > ul,.css-hnrfcf ul > ul{display:table-row;}.css-hnrfcf ol > ol::before,.css-hnrfcf ul > ol::before,.css-hnrfcf ol > ul::before,.css-hnrfcf ul > ul::before{display:table-cell;content:'';}.css-hnrfcf ul{display:table;}.css-hnrfcf ul>li{display:table-row;list-style:none;}.css-hnrfcf ul>li::before{display:table-cell;content:'•  ';white-space:pre;}.css-hnrfcf ol{display:table;counter-reset:ol;}.css-hnrfcf ol > li{display:table-row;list-style:none;}.css-hnrfcf ol > li::before{display:table-cell;text-align:right;counter-increment:ol;content:counter(ol) '. ';white-space:pre;}.css-hnrfcf ol ol{counter-reset:ol2;}.css-hnrfcf ol ol li::before{counter-increment:ol2;content:counter(ol2) '. ';}.css-hnrfcf ol ol ol{counter-reset:ol3;}.css-hnrfcf ol ol ol li::before{counter-increment:ol3;content:counter(ol3) '. ';}.css-hnrfcf ol ol ol ol{counter-reset:ol4;}.css-hnrfcf ol ol ol ol li::before{counter-increment:ol4;content:counter(ol4) '. ';}.css-hnrfcf figure{margin:1.4em 0;}.css-hnrfcf figure .content_image,.css-hnrfcf figure .origin_image{margin:0 auto;}.css-hnrfcf figure figcaption{margin-top:calc(0.6em / 0.9);padding:0 1em;font-size:0.9em;line-height:1.5;text-align:center;color:#999999;}.css-hnrfcf figure + figure{margin-top:calc(1.4em * 1.6);}.css-hnrfcf figure[data-size='small'],.css-hnrfcf figure:not([data-size]) > [data-size='small']{clear:both;}.css-hnrfcf figure[data-size='left'],.css-hnrfcf figure:not([data-size]) > [data-size='left']{float:left;margin:0 20px 20px 0;max-width:33%;}.css-hnrfcf figure[data-size='right'],.css-hnrfcf figure:not([data-size]) > [data-size='right']{float:right;margin:0 0 20px 20px;max-width:33%;}.css-hnrfcf figure[data-size='collapse']{margin-bottom:0;}.css-hnrfcf figure[data-size='collapse'] + figure{margin-top:0;}.css-hnrfcf .content_image,.css-hnrfcf .origin_image{display:block;max-width:100%;margin:1.4em auto;}.css-hnrfcf .content_image[data-size='small'],.css-hnrfcf .origin_image[data-size='small']{max-width:40%;}.css-hnrfcf .content_image.zh-lightbox-thumb,.css-hnrfcf .origin_image.zh-lightbox-thumb{cursor:-webkit-zoom-in;cursor:-moz-zoom-in;cursor:zoom-in;}.css-hnrfcf code{margin:0 2px;padding:3px 4px;border-radius:3px;font-size:0.9em;background-color:#F6F6F6;}.css-hnrfcf pre{margin:1.4em 0;padding:calc(0.8em / 0.9);font-size:0.9em;word-break:initial;word-wrap:initial;white-space:pre;overflow:auto;-webkit-overflow-scrolling:touch;background:#F6F6F6;border-radius:4px;}.css-hnrfcf pre code{margin:0;padding:0;font-size:inherit;border-radius:0;background-color:inherit;}.css-hnrfcf li pre{white-space:pre-wrap;}.css-hnrfcf table[data-draft-type='table']{border-collapse:collapse;font-size:15px;margin:1.4em auto;max-width:100%;table-layout:fixed;text-align:left;width:100%;}.css-hnrfcf table[data-draft-type='table'][data-size='small']{min-width:260px;width:40%;}.css-hnrfcf table[data-draft-type='table'][data-row-style='striped'] tr:nth-of-type(2n + 1){background:#F6F6F6;}.css-hnrfcf table[data-draft-type='table'] td,.css-hnrfcf table[data-draft-type='table'] th{border:1px solid #D3D3D3;line-height:24px;height:24px;padding:3px 12px;}.css-hnrfcf table[data-draft-type='table'] th{background:#EBEBEB;color:#121212;font-weight:500;}.css-hnrfcf .video-box,.css-hnrfcf .link-box{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:1.4em 0;overflow:auto;white-space:normal;cursor:pointer;border:solid 1px #EBEBEB;border-radius:4px;}.css-hnrfcf .highlight{margin:1em 0;}.css-hnrfcf .highlight pre{margin:0;}.css-hnrfcf .highlight .hll{background-color:#FDFDFD;}.css-hnrfcf .highlight .c{font-style:italic;color:#999999;}.css-hnrfcf .highlight .err{color:#F1403C;}.css-hnrfcf .highlight .k{font-weight:600;}.css-hnrfcf .highlight .o{font-weight:600;}.css-hnrfcf .highlight .cm{font-style:italic;color:#999999;}.css-hnrfcf .highlight .cp{font-weight:600;color:#999999;}.css-hnrfcf .highlight .c1{font-style:italic;color:#999999;}.css-hnrfcf .highlight .cs{font-style:italic;font-weight:600;color:#999999;}.css-hnrfcf .highlight .gd{color:#FF3366;}.css-hnrfcf .highlight .ge{font-style:italic;}.css-hnrfcf .highlight .gr{color:#F1403C;}.css-hnrfcf .highlight .gh{color:#999999;}.css-hnrfcf .highlight .gi{color:#12b370;}.css-hnrfcf .highlight .go{color:#808080;}.css-hnrfcf .highlight .gp{color:#646464;}.css-hnrfcf .highlight .gs{font-weight:600;}.css-hnrfcf .highlight .gu{color:#999999;}.css-hnrfcf .highlight .gt{color:#F1403C;}.css-hnrfcf .highlight .kc{font-weight:600;}.css-hnrfcf .highlight .kd{font-weight:600;}.css-hnrfcf .highlight .kn{font-weight:600;}.css-hnrfcf .highlight .kp{font-weight:600;}.css-hnrfcf .highlight .kr{font-weight:600;}.css-hnrfcf .highlight .kt{font-weight:600;color:#175199;}.css-hnrfcf .highlight .m{color:#0066FF;}.css-hnrfcf .highlight .s{color:#F1403C;}.css-hnrfcf .highlight .na{color:#0066FF;}.css-hnrfcf .highlight .nb{color:#0066FF;}.css-hnrfcf .highlight .nc{font-weight:600;color:#175199;}.css-hnrfcf .highlight .no{color:#0066FF;}.css-hnrfcf .highlight .ni{color:#5868D1;}.css-hnrfcf .highlight .ne{font-weight:600;color:#F1403C;}.css-hnrfcf .highlight .nf{font-weight:600;color:#F1403C;}.css-hnrfcf .highlight .nn{color:#646464;}.css-hnrfcf .highlight .nt{color:#175199;}.css-hnrfcf .highlight .nv{color:#0066FF;}.css-hnrfcf .highlight .ow{font-weight:600;}.css-hnrfcf .highlight .w{color:#BFBFBF;}.css-hnrfcf .highlight .mf{color:#0066FF;}.css-hnrfcf .highlight .mh{color:#0066FF;}.css-hnrfcf .highlight .mi{color:#0066FF;}.css-hnrfcf .highlight .mo{color:#0066FF;}.css-hnrfcf .highlight .sb{color:#F1403C;}.css-hnrfcf .highlight .sc{color:#F1403C;}.css-hnrfcf .highlight .sd{color:#F1403C;}.css-hnrfcf .highlight .s2{color:#F1403C;}.css-hnrfcf .highlight .se{color:#F1403C;}.css-hnrfcf .highlight .sh{color:#F1403C;}.css-hnrfcf .highlight .si{color:#F1403C;}.css-hnrfcf .highlight .sx{color:#F1403C;}.css-hnrfcf .highlight .sr{color:#C2A469;}.css-hnrfcf .highlight .s1{color:#F1403C;}.css-hnrfcf .highlight .ss{color:#F1403C;}.css-hnrfcf .highlight .bp{color:#999999;}.css-hnrfcf .highlight .vc{color:#0066FF;}.css-hnrfcf .highlight .vg{color:#0066FF;}.css-hnrfcf .highlight .vi{color:#0066FF;}.css-hnrfcf .highlight .il{color:#0066FF;}.css-hnrfcf .highlight::-webkit-scrollbar{width:6px;height:6px;}.css-hnrfcf .highlight::-webkit-scrollbar-thumb:horizontal{background-color:rgba(18,18,18,0.5);border-radius:6px;}.css-hnrfcf .highlight::-webkit-scrollbar-thumb:horizontal:hover{background-color:rgba(18,18,18,0.6);}.css-hnrfcf .LinkCard.old{position:relative;display:block;margin:1em auto;width:390px;box-sizing:border-box;border-radius:12px;max-width:100%;overflow:hidden;}.css-hnrfcf .LinkCard.old,.css-hnrfcf .LinkCard.old:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hnrfcf .LinkCard-ecommerceLoadingCard{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:12px;border-radius:inherit;height:80px;box-sizing:border-box;background:rgba(246,246,246,0.88);color:#D3D3D3;}.css-hnrfcf .LinkCard-ecommerceLoadingCardAvatarWrapper{width:60px;height:60px;background:#EBEBEB;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:6px;margin-right:10px;}.css-hnrfcf .LinkCard-ecommerceLoadingCardNetwork{width:20px;height:20px;}.css-hnrfcf .LinkCard-ecommerceLoadingCardLoadingbar{height:60px;-webkit-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}.css-hnrfcf .LinkCard-ecommerceLoadingCardLoadingbar span{height:16px;display:inline-block;background:#EBEBEB;}.css-hnrfcf .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(1){width:60px;margin-bottom:4px;}.css-hnrfcf .LinkCard-ecommerceLoadingCardLoadingbar span:nth-of-type(2){width:127px;}.css-hnrfcf .LinkCard.new{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;box-sizing:border-box;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;width:390px;min-height:84px;border-radius:8px;max-width:100%;overflow:hidden;margin:16px auto;padding:12px 12px 9px 12px;background-color:#F6F6F6;}.css-hnrfcf .LinkCard.new,.css-hnrfcf .LinkCard.new:hover{-webkit-text-decoration:none;text-decoration:none;border:none !important;color:inherit !important;}.css-hnrfcf .LinkCard.new .LinkCard-contents{display:block;-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;position:relative;}.css-hnrfcf .LinkCard.new .LinkCard-contents .loading{height:14px;background:#EBEBEB;border-radius:7px;}.css-hnrfcf .LinkCard.new .LinkCard-contents.withTitle{margin-bottom:3px;}.css-hnrfcf .LinkCard.new .LinkCard-title{display:-webkit-box;font-size:15px;font-weight:500;line-height:1.4;margin-bottom:2px;color:#121212;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hnrfcf .LinkCard.new .LinkCard-title.two-line{line-height:20px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hnrfcf .LinkCard.new .LinkCard-title.loading{margin-bottom:8px;width:80%;}.css-hnrfcf .LinkCard.new .LinkCard-title.loading.withTitle{margin-bottom:6px;}.css-hnrfcf .LinkCard.new .LinkCard-title.loadingTitle{margin-bottom:5px;}.css-hnrfcf .LinkCard.new .LinkCard-excerpt{display:-webkit-box;text-overflow:ellipsis;font-size:13px;line-height:18px;color:#999999;margin-bottom:4px;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hnrfcf .LinkCard.new .LinkCard-excerpt .LinkCard-author{color:#444444;}.css-hnrfcf .LinkCard.new .LinkCard-desc{display:-webkit-box;font-size:13px;height:18px;line-height:18px;color:#999999;word-break:break-all;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:1;}.css-hnrfcf .LinkCard.new .LinkCard-desc .LinkCard-tag,.css-hnrfcf .LinkCard.new .LinkCard-desc .tag{display:inline-block;font-size:11px;margin-left:8px;padding:0 4px;border-radius:3px;background:rgba(211,211,211,0.3);}.css-hnrfcf .LinkCard.new .LinkCard-desc.loading{width:40%;}.css-hnrfcf .LinkCard.new .LinkCard-desc svg{margin-right:2px;}.css-hnrfcf .LinkCard.new .LinkCard-image{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;background-color:#EBEBEB;background-size:cover;background-position:center;position:relative;display:block;width:60px;height:60px;margin-left:20px;object-fit:cover;border-radius:inherit;overflow:hidden;}.css-hnrfcf .LinkCard.new .LinkCard-image.LinkCard-image--default{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:#EBEBEB;color:#D3D3D3;}.css-hnrfcf .LinkCard.new .LinkCard-image.LinkCard-image--default svg{color:#999999;}.css-hnrfcf .LinkCard.new .LinkCard-image img{width:100%;height:100%;object-fit:cover;}.css-hnrfcf .LinkCard.new .LinkCard-image .LinkCard-image--video{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:absolute;top:50%;left:50%;-webkit-transform:translateX(-50%) translateY(-50%);-ms-transform:translateX(-50%) translateY(-50%);transform:translateX(-50%) translateY(-50%);width:24px;height:24px;border-radius:12px;background:rgba(255,255,255,0.9);pointer-events:none;}.css-hnrfcf .LinkCard.new .LinkCard-image .LinkCard-image--video svg{color:#444444;}.css-hnrfcf .LinkCard.new .LinkCard-richText .text{color:#444444;}.css-hnrfcf .LinkCard.new .LinkCard-richText .bold{font-weight:600;}.css-hnrfcf .LinkCard.new .LinkCard-richText .tag{margin-left:4px;}.css-hnrfcf .FileLinkCard{-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:rgba(246,246,246,0.88);border-radius:12px;box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:1em auto;max-width:100%;overflow:hidden;padding:12px;position:relative;width:390px;}.css-hnrfcf .FileLinkCard-icon{-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;height:30px;width:30px;}.css-hnrfcf .FileLinkCard-info{margin-left:12px;}.css-hnrfcf .FileLinkCard-name{color:#121212;font-size:15px;font-weight:500;line-height:21px;display:-webkit-box;text-overflow:ellipsis;overflow:hidden;-webkit-box-orient:vertical;-webkit-line-clamp:2;}.css-hnrfcf .FileLinkCard-meta{color:#999999;font-size:12px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;line-height:14px;margin-top:5px;}.css-hnrfcf .FileLinkCard-source{white-space:pre;}@-webkit-keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}@keyframes animation-1sh55c5{from{opacity:0;}to{opacity:1;}}</style><div class="RichText ztext Post-RichText css-hnrfcf" options="[object Object]"><p>作者：卫剑钒</p><p>2008年7月，在互联网上发生了一件极具历史意义的DNS安全事件，该事件一经发布，立即震动了整个互联网，因为，自1983年DNS被发明以来，人们还从未遇到过这类影响深远而易于实现的攻击。Cricket Liu, 《DNS and BIND》（O&#39;Reilly出版）的作者， 认为这<b>可能是互联网历史上最大的一次DNS安全事件。</b>[^cory]</p><p>这个攻击是美国人Dan Kaminsky精心构造的，他本人因此一战成名，该攻击也因此被命名为Kaminsky攻击。</p><p>漏洞由CERT于2008年7月8日发布[^cert]，但没有公布细节，Dan那时正在协助一些DNS厂商补上这个漏洞，并计划于8月6日在拉斯维加斯召开的Black Hat年度安全大会上披露全部细节内容（然而漏洞细节还是在7月21日被泄漏了出来），由于明明知道有漏洞却又不知道到底怎么回事，当时安全圈内颇有一些人对Dan表示了不满[^circle]。</p><p>该攻击令人恐惧之处在于，攻击者并不要求有什么特别的条件（比如占据某个路由交换节点可以监听和修改DNS报文），也无需使用社工之类的手段，攻击者就是一个普普通通的网络用户，却可以使用该方法，无差别地在全球复现这个攻击。</p><p>攻击产生的后果是什么？</p><p>后果是DNS服务器缓存中的记录被修改（所谓被“投毒”），比如用户本来想访问<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>，如果本机没有缓存，就会向本地DNS查询该域名的IP，但由于DNS服务器被投毒，所以用户得到的IP并不是想要去的地方，而是一个攻击者设定的IP，这样，用户就被牵引到完全可能是恶意的网站。</p><p><b>这种对IP的掉包，对搞信息安全的人来讲，哪怕是随便想一想，都会毛骨悚然。</b></p><p>在用户层面是无法感知和防范这种攻击的，因为攻击破坏了互联网底层的基础设施：域名服务。而域名服务正是那种它不出事时你意识不到它存在，一旦出事都是大事的东西。</p><p><b>本文将尽量让没有网络基础知识甚至是没有IT基础知识的人看懂。</b></p><p>了解这个攻击的关键在于了解DNS的原理。</p><h2>一、DNS基本知识：简单回顾</h2><p>本章属于扫盲性质，零基础的读者一定不要错过，有基础的同学可以简要掠过。</p><p>1、我们都知道在互联网上需要用IP的，但事实上，我们在使用的时候，通常输入的是域名而不是IP，比如我们输入<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>或者<a href="https://link.zhihu.com/?target=http%3A//www.taobao.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">taobao.com</span><span class="invisible"></span></a>，这种叫域名，类似39.156.66.18这种，才是IP。</p><p>2、互联网上传输数据都是要用IP的，<b>DNS所干的事，就是把域名转换为IP，也即域名解析</b>。比如浏览器拿到<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>后，通过DNS系统转换为IP，然后和该IP（比如39.156.66.18）建立通信，交互网页数据并向用户展示。</p><p>3、互联网上有非常多的域名服务器，共同完成域名解析功能。每个域名服务器内部会记录着一些域名和IP的对应（以及其他一些类似的数据），每条这样的数据称为一个<b>记录</b>。</p><p>4、不管在我们的电脑上，还是手机上（以下统称为<b>终端</b>），都会设置有DNS服务器的地址（通常被自动配置而无需手工配置），终端需要解析的时候，就去问它，它如果知道答案，就直接回复；如果不知道，就去网上问，最终会把答案（也即那个IP）返回给终端。这个DNS服务器常被称为本地DNS，它可能确实在家里、企业里、机场里、咖啡馆里，也有可能不在本地，比如114.114.114.114或者8.8.8.8这样的公用DNS服务器。</p><p>5、本地DNS可能是一个递归DNS，也可能只是一个DNS代理。递归DNS会不厌其烦地在互联网上尽力完成解析然后把结果返回终端，代理则只是把终端的请求转发给给真正干活的递归DNS，然后把递归DNS的答案转发给终端。<b>本文为描述方便，略去DNS代理这种简单的情况，不再区分本地DNS和递归DNS，将其统一简写为LDNS</b>。</p><p>6、最主要的DNS服务器就两种：递归DNS服务器和权威DNS服务器，为什么称之为“权威”，是因为它说了算，他说哪个域名对应哪个IP就是哪个IP。</p><p>7、LDNS如果已经通过查询得到了一个域名的IP，就会把它记在<b>缓存</b>里，下次再有人问这个域名，LDNS直接回复缓存里的答案即可。缓存只要不过期就可继续使用，过期后需要重新去网上查询。</p><p>基本知识就说到这里，DNS服务器还有其他一些类型（比如镜像域名服务器、唯缓存DNS服务器等），由于并不影响对攻击的理解，在此就略过不做介绍。</p><h2>二、对攻击的原理性解释</h2><p>最精简的解释：<b>攻击者通过精心构造DNS报文，在LDNS查询某个域名时，冒充真正的权威DNS做出回应，使得LDNS得到一个虚假响应。如果LDNS接受了这个虚假响应并写入缓存，LDNS就会中毒。</b></p><p>一个LDNS通常为多个用户服务，比如一个公司所有用户会使用相同的LDNS，再如ISP提供的LDNS，或者像8.8.8.8这种公用LDNS，更是为大量用户提供服务，所以LDNS一旦中毒，受害面就会很大。</p><p>成功实现这个攻击并不容易，否则Kaminsky也不会被载入史册。</p><p>攻击者要能在LDNS发出域名查询后，在真正的响应返回前，迅速发出多个伪造的响应包，以便让LDNS能够接受其中一个，如果成功，真正的响应将会被LDNS抛弃，因为来得太晚了，这次DNS查询已经结束了。</p><p>为了彻底搞明白Kaminsky攻击，我们需要有一些基础知识。</p><p>下面横线之间的部分是零基础读者需要看的，了解IP、UDP、端口等基本概念的读者可以直接略过。</p><hr/><p>DNS通常使用UDP包传输数据，从关系上讲，IP包里承载着UDP数据报，UDP数据报里承载着DNS报文，就像下面这样：</p><div class="highlight"><pre><code class="language-text">[IP包头[UDP报头[DNS数据报文]]]</code></pre></div><p><b>在IP包头中，最重要的数据是源IP地址和目的IP地址。</b></p><p>在LDNS向某个权威DNS发送查询包时，源IP地址就是LDNS的IP地址，目的IP地址就是权威DNS的IP地址。</p><p>当权威DNS回应时，响应包中的目的IP为LDNS，源IP为权威DNS的IP，正好反过来了。</p><p>攻击者得到权威DNS的IP并不难，然后就可以用这个IP伪造是权威DNS发出的包了。</p><p><b>在UDP报头里，最重要的是源端口和目的端口。</b></p><p>这里简要介绍一下什么是端口，我们知道每台服务器至少会有一个IP地址，但这个IP上会跑多个程序，如果只有IP概念而没有端口概念的话，当一个IP包送到这个IP对应的服务器时，操作系统就不知道将这个包送给哪个程序。</p><p>有了端口的概念，就可以区分一个IP上的多个程序了，比如通常一个web server会在80端口等待数据包，一个SSH服务会在22端口等待数据包，所以说，目的端口号，事实上指定了要获取的服务。</p><p>DNS服务器是在53号端口等待服务的，如果权威DNS同时还提供了web服务（比如一个管理DNS的web界面），那么该服务器收到端口号是80的包，就会送给web server，收到端口号为53的包，就会送给name server（也即DNS）。</p><p>就像源IP、目的IP一样，源端口、目的端口在查询包和响应包中是反过来的，响应包中的目的端口正是查询包中的源端口，响应包中的源端口正是查询包中的目的端口。由于DNS查询包的目的端口是53，所以响应包的源端口就是53。</p><p>基础中的基础介绍到此为止。</p><hr/><p>下面介绍一下DNS报文的结构，这个也属于基础知识，但如果不是专门搞DNS的，大多数人即便专门了解过，都不太会记得，因为没事的时候没人关心这个。</p><p>DNS查询报文和响应报文的格式是一样的，可以很精简地写成下面的样子：</p><div class="highlight"><pre><code class="language-text">DNS报文：|QID|问题区|应答区|权威区|附加区|</code></pre></div><p>先看下最前面那个QID，QID即查询ID，是用于匹配查询报文和相应报文的，LDNS每次向外发出DNS查询报文，都会设置一个不同的QID，原因是同一时刻可能会有多个查询，有了QID，可以方便地把响应和查询匹配起来（响应报文中会填写和对应查询一致的QID）。</p><p>至于QID之后的4个区是做什么用的，后面再介绍。</p><p>为什么需要了解这些基础知识，是因为LDNS在发出查询包后，只接受它意欲等待的响应包，对于IP不对的、端口不对的，格式不对的、QID不对的，域名不对的，应答不对的，以及其他各种莫名其妙的包，都会被LDNS抛弃。</p><p>那么攻击者要怎么才能通过这些检查呢？</p><p>主要的几个难点是：</p><p>1、攻击者要能知道LDNS发出UDP报头中的源端口。攻击者不能窃听，所以这并不容易获取，好在2008年的时候，很多LDNS的实现并不重视源端口的随机化，有的LDNS直接使用53作为源端口，有的LDNS由操作系统选择的一个固定的值，有的则是对同一个终端用户采用同一个源端口，当然，也有很谨慎的LDNS（如djbdns），每次DNS查询都使用不同的端口号。</p><p>2、DNS报文中的查询ID（QID）要对得上，2008年的时候，QID早已实现了随机化，所以攻击者要匹配上QID，是需要点功夫的。</p><p>3、DNS报文中各个数据区中的内容，要能被LDNS认可和接受，后面我们会看到，这需要精通DNS原理并花心思精心设计。</p><h2>三、是时候介绍DNS原理了</h2><p>下面的描述先不考虑有缓存的情况，而是考虑从头来过查询一个域名。</p><p>比如要查询<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>这个的域名，LDNS会怎么做呢，去哪里问？</p><p>有那么一台集中的、统一的、无所不知的、永远正确的域名服务器吗？</p><p>显然没有。</p><p>全世界的域名太多了，集中统一管理的成本太高、弊端也太多，在互联网上，是不会这么做的。</p><h3>（一）递归DNS所采用的递归式查询到底是什么样的</h3><p>域名服务器是层级式管理的，也即有多层DNS，最高一层是“根DNS”，然后接下来的是“顶级域名DNS”，根DNS负责回答顶级域名DNS（也即一级域名DNS）在哪里，顶级域名DNS负责回答二级域名DNS在哪里，二级域名DNS负责回答三级域名DNS在哪里……</p><p>上面这些都是权威DNS（因为他们对自己负责范围的应答都是权威的）。</p><p>（注意也有人把<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>叫做一级域名，把<a href="https://link.zhihu.com/?target=http%3A//abc.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">abc.baidu.com</span><span class="invisible"></span></a>这种叫做二级域名的，确实存在一些混乱，但对理解本文无关紧要。）</p><p>举个例子，你拿<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>问root(根DNS)，root告诉你去问com的权威DNS（顶级域名DNS），com告诉你去问<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的权威DNS(即二级域名DNS)，后面我们会看到，<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>又让你去问<a href="https://link.zhihu.com/?target=http%3A//shifen.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">shifen.com</span><span class="invisible"></span></a>，总之，就这么不断往复的问下去，最终，你会问到<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的IP。</p><p>这就是一个递归的过程。</p><p>下面说的稍微详细一点：</p><p>1、LDNS问根DNS说“<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的IP是多少呀”。</p><p>2、根DNS是不会直接给出答案的，因为它很忙，不会管这么具体的事，但它记录着.com  .cn  .net  .org  .edu  .gov  .us  .hk  .jp这些顶级域的权威DNS在哪里，所以它回答说“你先去问com顶级域的DNS吧，我只管到顶级域，诺，这些是com顶级域名DNS的名字（本身也是个域名）和IP，你去问它们吧”，这其实就是给出了下一步问询的对象（referral）。</p><p>3、然后LDNS向com的权威DNS发出请求，它记录着<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//taobao.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">taobao.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//google.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">google.com</span><span class="invisible"></span></a>这些二级域的权威DNS在哪里，它回答LDNS说：“你去问<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的DNS吧，他掌管着<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>这个域的解析，他会告诉你答案，他的名字是<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>，他的IP是……”。（事实上会给出多个名字和IP，比如<a href="https://link.zhihu.com/?target=http%3A//ns1.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//ns2.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns2.baidu.com</span><span class="invisible"></span></a>等等和对应的IP）</p><p>注：这里出现一个概念叫“域”（zone），这是什么东西？这其实就是域名中不同长度的以.分割的后缀，比如com是个域，它是顶级域，<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//taobao.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">taobao.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//qq.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">qq.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//google.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">google.com</span><span class="invisible"></span></a>作为com的子域，称为二级域，<a href="https://link.zhihu.com/?target=http%3A//abc.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">abc.baidu.com</span><span class="invisible"></span></a>（举例而已，未必有这个域）这种是三级域。</p><p>4、LDNS会继续问<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>（事实上有多个），它负责这个域下面三级域名如<a href="https://link.zhihu.com/?target=http%3A//zhidao.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">zhidao.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//wenku.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">wenku.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//image.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">image.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//tieba.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">tieba.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//map.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">map.baidu.com</span><span class="invisible"></span></a>的解析。<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>会给出答案，可能会直接给出IP（即A记录），也可能会给出一个CNAME记录。</p><p>等等，这是什么？</p><p>现在我们需要了解最常见的几种DNS记录。</p><h3>（二）最常见的三种DNS记录</h3><p><b>DNS记录是用于解析的数据，最常见的3种记录为：NS记录、A记录、CNAME记录。</b></p><h3>第一种：NS记录</h3><p>如果DNS给你回应一条NS记录，就是告诉你，这个家伙是某个域的权威DNS，有事你去问它。</p><p>比如在com的DNS里，记录着<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>这个域的DNS，长的大概是这个样子：</p><div class="highlight"><pre><code class="language-text">baidu.com.  NS  ns1.baidu.com.
baidu.com.  NS  ns2.baidu.com.
baidu.com.  NS  ns3.baidu.com.</code></pre></div><p>这三条记录，就是说<a href="https://link.zhihu.com/?target=http%3A//ns1.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//ns2.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns2.baidu.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//ns3.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns3.baidu.com</span><span class="invisible"></span></a>(以下简称ns1、ns2、ns3)都是<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>域的权威DNS，问任意其中一个都可以（一般都是顺序问的，如果连不上第一个，就去找第二个）。</p><p>注意，域名后面会比我们平时见到的多一个“.”，这就代表了根，严格地说，所有域名后面都应该有这一个“.”的，比如完整的<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>域名应该是www.baidu.com.，也可以把所有域名都看作有一个.root的后缀，比如www.baidu.com.root，但由于每个域名都有这个后缀，所以干脆就都省略了。（本文后面也都会省略这个“.”）</p><p>当然，在com的权威DNS里，还会记录ns1~ns3这几个<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>权威DNS的IP，会一并返回给问询者，以便问询者直接用IP联系ns1～ns3。</p><h3>第二种：A记录</h3><p>A记录就是最经典的域名和IP的对应，在<a href="https://link.zhihu.com/?target=http%3A//ns1.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.baidu.com</span><span class="invisible"></span></a>里面，记录着百度公司各产品的域名和IP的对应关系，每一个这样的记录，就是一个A记录，比如下面的3个A记录（随意举的例子，IP都是随意写的）。</p><div class="highlight"><pre><code class="language-text">image.baidu.com     A       1.2.3.4
wenku.baidu.com     A       5.6.7.8
tieba.baidu.com     A       9.10.11.12</code></pre></div><p>如果有人问<a href="https://link.zhihu.com/?target=http%3A//ns1.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.baidu.com</span><span class="invisible"></span></a>：“<a href="https://link.zhihu.com/?target=http%3A//wenku.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">wenku.baidu.com</span><span class="invisible"></span></a>的IP是多少？”，ns1就会找到对应的A记录或者CNAME记录并返回。</p><h3>第三种：CNAME记录</h3><p>这种记录比较有趣，你问DNS一个域名，它回CNAME记录，意思是说，你要解析的这个域名，还有另一个域名(也就是别名)，你去解析那个好了。</p><p>比如，在ns1中，其实并没有<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的A记录，而是一个CNAME记录：</p><div class="highlight"><pre><code class="language-text">www.baidu.com       CNAME   www.a.shifen.com</code></pre></div><p>这就是在告诉LDNS，<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的别名是<a href="https://link.zhihu.com/?target=http%3A//www.a.shifen.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">a.shifen.com</span><span class="invisible"></span></a>，去解析<a href="https://link.zhihu.com/?target=http%3A//www.a.shifen.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">a.shifen.com</span><span class="invisible"></span></a>吧！</p><p>然后LDNS再发起一次针对这个别名的解析，直到最终获得A记录拿到IP。</p><h3>(三）关于缓存</h3><p>前面的介绍都没有涉及缓存，所以那些过程都是一个理论上的过程，有了缓存以后，你会发现，实际过程和理论过程相差甚远。</p><p>缓存不仅仅存在于LDNS中，也存在于操作系统中、浏览器中、以及一些应用中。按道理，缓存的时间应该以权威DNS返回记录中的TTL（存活时间）为准，但事实上，根据应用、浏览器、操作系统自己的喜好，一般都会有所调整，而不是完全按照TTL来做的。</p><p>上面的那些例子中，为了简洁起见，没有列出TTL，事实上，一个完整的记录大概是这个样子：</p><div class="highlight"><pre><code class="language-text">baidu.com.      86400   IN  NS  ns3.baidu.com.</code></pre></div><p>其中的86400就是TTL，是以秒为单位的，86400也就是24小时即1天。</p><p>其中的“IN”指的是互联网类型的域名，通常都是如此，还有一种类型是“CHAOS”，几乎没用。</p><p>有了缓存以后，一个域名的解析，就不再是前面介绍的那种从根问起的过程了，举个例子，比如在浏览器中输入<a href="https://link.zhihu.com/?target=http%3A//123.abc.qq.com.cn" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">123.abc.qq.com.cn</span><span class="invisible"></span></a>，浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回，如果没有，就去问操作系统，操作系统也会去看自己的缓存，如果没有，再去hosts文件看，也没有，才会去问LDNS。</p><p>LDNS会去先看看自己有没有<a href="https://link.zhihu.com/?target=http%3A//123.abc.qq.com.cn" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">123.abc.qq.com.cn</span><span class="invisible"></span></a>的A记录，要有就直接返回，要没有，就去看有没有<a href="https://link.zhihu.com/?target=http%3A//abc.qq.com.cn" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">abc.qq.com.cn</span><span class="invisible"></span></a>的NS记录，如果有，就去问它要答案，如果没有，就去看有无<a href="https://link.zhihu.com/?target=http%3A//qq.com.cn" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">qq.com.cn</span><span class="invisible"></span></a>的NS的记录，如果有，就去问它，没有就去看有无<a href="https://link.zhihu.com/?target=http%3A//com.cn" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">com.cn</span><span class="invisible"></span></a>的DNS，还没有就去看有无cn的DNS，如果连cn的DNS都找不到，才去问根。</p><p>所以你看，有了缓存以后，前面讲的那种从根问起的情况，事实上是很少的。</p><h3>（四）DNS报文内容</h3><p>现在，到了DNS原理的最后时刻了……</p><p>再看一眼DNS报文结构：</p><div class="highlight"><pre><code class="language-text">|QID|问题区|应答区|权威区|附加区|</code></pre></div><p>查询报文（以下简称查询包）只是填写QID和问题区（也即要问什么），后面几个区不用填写内容。</p><p>响应报文（以下简称响应包）会填写QID（和对应查询包中的QID一致）、问题区（和对应查询包中的问题一致），还会填写后面几个区：应答区、权威区（也即填写权威DNS的区域，）、附加区。</p><p>这几个区的主要作用是：</p><p><b>问题区</b>（Question Section）：这里填写所要查询的问题（可以是一个或多个），主要填查询内容和查询类型，比如想要查<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的A记录，就填<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>和A。</p><p><b>应答区</b>（Answer Section）：这里给出查询问题的答案，对于A记录类型的问题，这里会给出一个或多个A记录，也可能给出一个或多个CNAME记录。当然，如果问题问的是NS记录，这里就会应答NS记录。</p><p><b>权威区</b>（Authority Section）：这里给出一个或多个NS记录，其实就是那些referral，也即告诉LDNS问谁会更接近答案一些，比如com的DNS会在这里给出<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的权威DNS（可以给出多个）。注意，在必要情况下，权威DNS在应答区给出回答的同时，还会在权威区给出NS记录。</p><p><b>附加区</b>（Additional Section）：这里存放附加的一些记录。比如在给出权威NS记录的同时，会把它的A记录放在这里（在NS记录中是不会有IP的），这样做的好处是可以解决鸡生蛋蛋生鸡的问题，比如你查<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>，权威告诉你去找<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>，如果没有这个附加的A记录（又称胶水记录，glue record），你就得去问<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>的A记录，然后权威又告诉你去找<a href="https://link.zhihu.com/?target=http%3A//ns.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.baidu.com</span><span class="invisible"></span></a>，这就进入一个无解的循环之中。</p><p>前面讲，LDNS查询<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>，<a href="https://link.zhihu.com/?target=http%3A//baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的权威DNS可能会回一个A记录，也可能回一个CNAME记录，具体如何？我们实际看一下。</p><p>查询包大约是这样的：</p><div class="highlight"><pre><code class="language-text">QID：6012
问题区：  www.baidu.com A
应答区：（空）
权威区：（空）
附加区：（空）</code></pre></div><p>通过抓包，可以看到响应包大约是这样的：</p><div class="highlight"><pre><code class="language-text">QID：6012
问题区：www.baidu.com A
应答区：www.baidu.com.  CNAME   www.a.shifen.com.
权威区：
        a.shifen.com.       NS  ns1.a.shifen.com.
            a.shifen.com.       NS  ns2.a.shifen.com.
附加区：
        ns2.a.shifen.com.   A   61.135.165.224
        ns2.a.shifen.com.   A   220.181.33.32</code></pre></div><p>由于得到的是CNAME记录，LDNS为了得到IP，还会继续发起对<a href="https://link.zhihu.com/?target=http%3A//www.a.shifen.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">a.shifen.com</span><span class="invisible"></span></a>的查询，最终获得其IP。</p><p>现在，有了这些基础知识，基本上就差不多了，我们看看Kaminsky攻击是怎么做到的。</p><h2>四、对攻击的详细解释</h2><p>首先明确一下攻击目标和限制条件：</p><h3><b>攻击目标：</b></h3><p>更改LDNS的缓存：使得其中关于<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的对应IP改为攻击者希望的IP。（foo只是一个例子，你可以自行在这里把foo脑补为baidu、taobao、google等等。）</p><h3><b>攻击条件和限制：</b></h3><p>攻击者无法监听LDNS发出和接收的网络数据，无法截断和篡改LDNS发出和接收的网络数据，无法通过各种攻击直接获取LDNS缓存的读写能力。</p><p><b>其实，这就是一个普普通通攻击者在网络上的真实能力。</b></p><p>比较一般的攻击思路大约是这样：</p><p>在LDNS发出关于<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的查询请求时，攻击者想方设法发送伪造的响应包并尽快回应（要比真正的响应包快一步送达），该伪造的响应包里面，有伪造的<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的A记录，A记录里的IP是攻击者想伪造的IP，只要该报文被LDNS接收，并且把其中相关的记录记入缓存，目标即达成。</p><p>后面我们会看到，这种思路只有一部分是对的，直接伪造<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的A记录并不可行，至少缓存这关会过不去。</p><h3>攻击成功的4个关键点</h3><p>1、要把握住时机，要能控制或知道什么时候LDNS发出针对某个域名的查询包。</p><p>2、响应包中的目的端口正是查询包里的源端口。</p><p>3、响应包中的QID也是对的。</p><p>4、响应包中的记录被LDNS接受并计入缓存。（这是最重要的）</p><h3>先看第一个关键点，如何把握时机？</h3><p>在我们的假设中，攻击者是可以获取LDNS服务的，那么只要攻击者作为终端用户，向LDNS提出解析请求，就有可能让LDNS向外发起查询，然后攻击者就可以立刻回应伪造的包（这就会比权威DNS快，毕竟权威DNS是收到查询包后才响应的），这就好比攻击者掌握着“发令枪”，所以在这个竞赛中，攻击者比真正的权威DNS有优势的。</p><h3>关于第二个关键点，UDP源端口如何匹配？</h3><p>前面提到过，在发出查询的时候，大多数流行的LDNS使用了相对固定的UDP源端口，对攻击者而言，这就好办多了。</p><p>具体的做法可以是，攻击者让LDNS先查询一次自己控制的域名比如<a href="https://link.zhihu.com/?target=http%3A//badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">badguy.com</span><span class="invisible"></span></a>，由于自己控制着这台服务器，在服务器上抓包或者直接通过源码打印输出，就可以知道LDNS所使用的UDP源端口了。</p><p>在2008年那个时候，BIND、微软的MSDNS、Nominum等LDNS都存在这个问题，但djbdns、PowerDNS、 MaraDNS没有这个问题（它们在设计时就使用了随机的源端口），但显然BIND和MSDNS在当时是使用最广泛的LDNS。</p><h3>关于第三个关键点，QID如何匹配？</h3><p>LDNS每发出一次查询，其QID都是不同的，QID字段大小16位，所以一共会有65536个值。</p><p>早期的LDNS实现中，不用拍脑袋都可以想象，程序员当然是下意识按照递增+1的方式来变化QID的，但在1997年，人们发现这容易被攻击者猜测到[^joe]，所以大多数LDNS的实现中，早已实现了QID的随机化，在2008年，攻击者要想拿出正确的QID，只能靠猜。</p><p>现实中，攻击者面临的巨大困难是：如果LDNS已经有关于<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的缓存，那么只有在缓存过期的时候，才会向外发出关于该域名的查询，如果这个缓存有效期是1天，那就需要等上1天才能够发起一次攻击，因为在这一天内，LDNS都是直接在缓存中取答案的，根本不需要向外发起解析。</p><p>假设攻击者在真正的响应包返回前能有100次的猜测机会（猜错的会被抛弃，猜对的会被接收），由于缓存的存在，那么他平均需要1天*65536/100*1/2的时间（327天）才能成功[^dmk]。</p><p>Dan Kaminsky所使用的方法可没有这么笨，Dan不会去等待缓存失效的，他会让主动让LDNS发起一次域名查询，<b>这正是Dan的攻击方法中最创新的一点</b>：</p><p>Dan会去问类似<a href="https://link.zhihu.com/?target=http%3A//1.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.foo.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//2.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">2.foo.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//3.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">3.foo.com</span><span class="invisible"></span></a>等等这些大概率就完全不存在的域名，由于LDNS并没有这些域名的缓存，就会发起查询，假设<a href="https://link.zhihu.com/?target=http%3A//ns1.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.foo.com</span><span class="invisible"></span></a>是<a href="https://link.zhihu.com/?target=http%3A//foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">foo.com</span><span class="invisible"></span></a>的权威DNS，LDNS就会去<a href="https://link.zhihu.com/?target=http%3A//ns1.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns1.foo.com</span><span class="invisible"></span></a>询问，由于Dan每发一个这样的包，LDNS都会去问一次，攻击者也就有一次猜测的机会。</p><p>通常，使用这种方法，大约不到10秒就可以猜测QID成功！[^steve]</p><p>假设，终于在发送到<a href="https://link.zhihu.com/?target=http%3A//83.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">83.foo.com</span><span class="invisible"></span></a>的时候，攻击者的QID正好和LDNS发出查询包中的那个QID一样，这时，源端口和QID都对了，攻击几乎就要成功了！</p><h3>最后一个关键点，如何让LDNS接受内容？</h3><p>肯定有人会问，我们要投毒的是<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>，搞定<a href="https://link.zhihu.com/?target=http%3A//83.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">83.foo.com</span><span class="invisible"></span></a>有什么意义啊。</p><p>没错，我们的目标并不是<a href="https://link.zhihu.com/?target=http%3A//83.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">83.foo.com</span><span class="invisible"></span></a>，这个攻击比较精彩的地方是，Dan并不是在应答区做手脚，而是在权威区和附加区行骗！</p><p>Dan伪造的响应包，大约是这个样子：</p><div class="highlight"><pre><code class="language-text">问题区：83.foo.com  A
应答区：（空）
权威区：foo.com  NS www.foo.com
附加区：www.foo.com  A 6.6.6.6</code></pre></div><p>这个响应的意思是：“我不知道<a href="https://link.zhihu.com/?target=http%3A//83.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">83.foo.com</span><span class="invisible"></span></a>的A记录，你去问问<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>吧，它负责<a href="https://link.zhihu.com/?target=http%3A//foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">foo.com</span><span class="invisible"></span></a>这个域，对了，他的IP是6.6.6.6”。</p><p>而这里的6.6.6.6，就是攻击者意欲让LDNS相信的IP地址。</p><p>不太熟悉DNS的读者可能会觉得奇怪，<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>也可以是一个DNS的名字？当然可以，有哪个标准说过，域名服务器非要起<a href="https://link.zhihu.com/?target=http%3A//ns.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.foo.com</span><span class="invisible"></span></a>这样的名字呢，只要是个域名就可以了。</p><p>没有任何毛病，LDNS当然会接受这个NS记录，以及后面的这个胶水记录（就是那个A记录），大功告成！</p><p>这样的攻击，不仅污染了<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>，还污染了整个<a href="https://link.zhihu.com/?target=http%3A//foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">foo.com</span><span class="invisible"></span></a>域，因为之后所有此域下的解析，在缓存有效期内，都会去问6.6.6.6，也即问到攻击者那里！（缓存失效后可以再次发起攻击）</p><h3>前面没有提及的bailiwick检查</h3><p>这个攻击之所以出人意料，在于他能通过bailiwick检查，DNS投毒（或者说缓存污染）并不是新鲜事，bailiwick检查被设计出来专门防范缓存污染，主要原则是：如果检查发现附加区中的记录和问题区中的问题不在同一个域管辖之下，就会格外谨慎而不会采信（更不会记入缓存）此记录，这可以防范恶意权威DNS发出虚假的记录以污染缓存。</p><p>为了理解bailiwick检查，可以看一个简单的例子：</p><div class="highlight"><pre><code class="language-text">问题区:
    www.foo.com  A 1.2.3.4
权威区:
    foo.com     NS  ns1.foo.com
附加区:
    ns1.foo.com A 2.3.4.5
    www.bar.com A 6.6.6.6</code></pre></div><p>上面例子中，用户请求<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的时候，响应包里出现关于<a href="https://link.zhihu.com/?target=http%3A//www.bar.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">bar.com</span><span class="invisible"></span></a>的记录，DNS将根据bailiwick检查规则，不会接受将此A记录。更多关于bailiwick检查的知识可见本文参考资料[^shmat]。</p><p>bailiwick检查自1997年就已经被普遍重视和实现了，在人们觉得普通攻击者很难实现缓存污染的情况下，Kaminsky攻击横空出世，所以颇令人震惊。</p><h3>更进一步？</h3><p>现在考虑让攻击更激进一点，攻击一个不对外提供服务的企业内部的LDNS。</p><p>上面的讲解中，攻击者本身是LDNS的一个客户，所以攻击者可以任意地发出解析请求。如果LDNS位于企业内部不向攻击者提供服务呢。</p><p>Dan在黑帽大会的演讲中，指出有很多种方法可以突破，这里举其中一个比较浅显的例子：比如设法让企业内部的人浏览一个含有很多链接的网页，这些链接分别指向<a href="https://link.zhihu.com/?target=http%3A//1.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.badguy.com</span><span class="invisible"></span></a>（badguy是被攻击者控制的域名）、<a href="https://link.zhihu.com/?target=http%3A//2.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">2.badguy.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//3.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">3.badguy.com</span><span class="invisible"></span></a>、<a href="https://link.zhihu.com/?target=http%3A//4.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">4.badguy.com</span><span class="invisible"></span></a>……等等，一旦<a href="https://link.zhihu.com/?target=http%3A//ns.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">ns.badguy.com</span><span class="invisible"></span></a>收到关于<a href="https://link.zhihu.com/?target=http%3A//1.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.badguy.com</span><span class="invisible"></span></a>的解析请求，他就知道该网页开始被浏览了，针对<a href="https://link.zhihu.com/?target=http%3A//1.badguy.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.badguy.com</span><span class="invisible"></span></a>请求，它会回一个：</p><div class="highlight"><pre><code class="language-text">问题区：1.badguy.com  A  
应答区：（空）
权威区：badguy.com  NS  1.foo.com
附加区：（空）</code></pre></div><p>这是一个典型的“去问别人吧”（refrral）回应，也即告诉LDNS去问<a href="https://link.zhihu.com/?target=http%3A//1.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.foo.com</span><span class="invisible"></span></a>，攻击者知道，LDNS收到这个响应后，会发起关于<a href="https://link.zhihu.com/?target=http%3A//1.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">1.foo.com</span><span class="invisible"></span></a>的查询，所以攻击者立刻发送一波伪造的响应给LDNS，这些响应使用不同的QID来猜测，内容则是：</p><div class="highlight"><pre><code class="language-text">问题区：1.foo.com  A  
应答区：（空）
权威区：foo.com NS www.foo.com
附加区：www.foo.com  A   6.6.6.6</code></pre></div><p>看到这里，你就明白，这就和前面的攻击模式一样了。</p><p>也许又是在第83次，攻击者又成功了～</p><div class="highlight"><pre><code class="language-text">问题区：83.foo.com  A  
应答区：（空）
权威区：foo.com NS www.foo.com
附加区：www.foo.com A 6.6.6.6</code></pre></div><p>攻击者为什么不一开始就直接像下面这样回应呢：</p><div class="highlight"><pre><code class="language-text">问题区：1.badguy.com  A  
应答区：（空）
权威区：badguy.com NS www.foo.com
附加区：www.foo.com  A   6.6.6.6</code></pre></div><p>这样难道不是更直接更迅速吗？都不用猜QID了。</p><p>这样做是不行的，就像前面说的，大多数LDNS都有做bailiwick检查，由于附加区的记录和问题区的问题不在一个域，LDNS会弃这个A记录不用，而是针对<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>发起另一次查询。</p><p>Dan在他的Black Hat演讲PPT中还给出了其他一些方法，有兴趣的可以下载来看一下，这篇PPT着实非常精彩，作者要说的话基本都体现在PPT上，即便没有解说，也完全能够看懂。</p><p>以上就是对Dan kaminsky攻击的介绍。</p><h2>五、针对攻击的漏洞修补</h2><p>1、就像1997年普遍实现QID随机化那样，要让UDP源端口也实现真正的随机化（当然不能是伪随机数！），这会让攻击难度显著提升，在最好的情况下，攻击者要攻击的随机数空间达到65536*65536，虽然在一般的实现中，不会用尽这么大的空间。比如，2008年，微软将自己的DNS服务器更新为使用2500个UDP源端口6。</p><p>2、继续确保严格的Bailiwick检查，并采取更谨慎的态度和做法。比如在BIND9的实现中，如果缓存中有来自应答区的<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的A记录，那么来自附加区的<a href="https://link.zhihu.com/?target=http%3A//www.foo.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">foo.com</span><span class="invisible"></span></a>的A记录将不能覆盖前者。</p><p>3、David Dagon提出了一种比较有趣的思路[^dagon]，可以了解一下，就是LDNS在向外发出查询时，所查询域名中每个字母的大小写随机安排，比如查询域名<a href="https://link.zhihu.com/?target=http%3A//www.baidu.com" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">baidu.com</span><span class="invisible"></span></a>的时候，问题写为<a href="https://link.zhihu.com/?target=http%3A//wWW.bAIdU.cOM" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">wWW.bAIdU.cOM</span><span class="invisible"></span></a>或者<a href="https://link.zhihu.com/?target=http%3A//WwW.baIDU.CoM" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://</span><span class="visible">WwW.baIDU.CoM</span><span class="invisible"></span></a>等等（域名本身是大小写不敏感的），并且要求响应包中的问题和此匹配，这使得攻击者不仅要匹配源端口、QID，还要匹配这个写法，增加了猜测难度。</p><p>4、一些并未得到广泛采用的手段，比如限制用户在短时间内发起大量的DNS查询。</p><p>5、一些尚未得到普遍实施的安全机制，如DNSSEC、DNS over HTTPS等。</p><p>参考资料：</p><p>[^cert]: Multiple DNS implementations vulnerable to cache poisoning (<a href="https://link.zhihu.com/?target=https%3A//www.kb.cert.org/vuls/id/800113/" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">kb.cert.org/vuls/id/800</span><span class="invisible">113/</span><span class="ellipsis"></span></a>)</p><p>[^dmk]: It’s The End Of The Cache As We Know It (<a href="https://link.zhihu.com/?target=https%3A//www.slideshare.net/dakami/dmk-bo2-k8" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">slideshare.net/dakami/d</span><span class="invisible">mk-bo2-k8</span><span class="ellipsis"></span></a>)</p><p>[^steve]: An Illustrated Guide to the Kaminsky DNS Vulnerability (<a href="https://link.zhihu.com/?target=http%3A//www.unixwiz.net/techtips/iguide-kaminsky-dns-vuln.html" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">unixwiz.net/techtips/ig</span><span class="invisible">uide-kaminsky-dns-vuln.html</span><span class="ellipsis"></span></a>)</p><p>[^cory]: Understanding Kaminsky&#39;s DNS Bug ( <a href="https://link.zhihu.com/?target=https%3A//www.linuxjournal.com/content/understanding-kaminskys-dns-bug" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">linuxjournal.com/conten</span><span class="invisible">t/understanding-kaminskys-dns-bug</span><span class="ellipsis"></span></a> )</p><p>[^circle]: Not a Guessing Game (<a href="https://link.zhihu.com/?target=http%3A//www.circleid.com/posts/87143_dns_not_a_guessing_game/" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">circleid.com/posts/8714</span><span class="invisible">3_dns_not_a_guessing_game/</span><span class="ellipsis"></span></a>)</p><p>[^shmat]: The Hitchhiker’s Guide to DNS Cache Poisoning (<a href="https://link.zhihu.com/?target=https%3A//www.cs.cornell.edu/~shmat/shmat_securecomm10.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://www.</span><span class="visible">cs.cornell.edu/~shmat/s</span><span class="invisible">hmat_securecomm10.pdf</span><span class="ellipsis"></span></a>)</p><p>[^Joe]: DNS Cache Poisoning - The Next Generation (<a href="https://link.zhihu.com/?target=http%3A//www.ouah.org/DNScp.htm" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">http://www.</span><span class="visible">ouah.org/DNScp.htm</span><span class="invisible"></span></a>)</p><p>[^dagon]: Increased DNS forgery resistance through 0x20-bit encoding (<a href="https://link.zhihu.com/?target=https%3A//astrolavos.gatech.edu/articles/increased_dns_resistance.pdf" class=" external" target="_blank" rel="nofollow noreferrer"><span class="invisible">https://</span><span class="visible">astrolavos.gatech.edu/a</span><span class="invisible">rticles/increased_dns_resistance.pdf</span><span class="ellipsis"></span></a>)</p><p>感谢微信号 @king432287 @simonzhao7727 @diifee @wenzel 在本文撰写过程中予以的答疑解惑。</p><p>本文采用<b>知识共享“署名-相同方式共享”4.0国际许可协议</b>进行许可。</p><p class="ztext-empty-paragraph"><br/></p><figure data-size="normal"><noscript><img src="https://pic1.zhimg.com/v2-e839c50dedeb1edeb114d7a259c9ab80_b.jpg" data-caption="" data-size="normal" data-rawwidth="276" data-rawheight="320" class="content_image" width="276"/></noscript><img src="data:image/svg+xml;utf8,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; width=&#39;276&#39; height=&#39;320&#39;&gt;&lt;/svg&gt;" data-caption="" data-size="normal" data-rawwidth="276" data-rawheight="320" class="content_image lazy" width="276" data-actualsrc="https://pic1.zhimg.com/v2-e839c50dedeb1edeb114d7a259c9ab80_b.jpg"/></figure><p class="ztext-empty-paragraph"><br/></p><p><b>关注本公众号“微月人话”（ID：man-mind）</b>，回复DNS，获取：</p><p>1、作者制作的DNS原理及攻击介绍PPT，用于培训讲解。</p><p>2、Kaminsky在Black Hat上的关于这次攻击的演讲PPT。</p></div></div></div><div role="button" tabindex="0" class="ContentItem-time">发布于 2019-11-21</div><div class="Post-topicsAndReviewer"><div class="TopicList Post-Topics"><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19581904" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">DNS</div></div></a></span></div><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19577410" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">DNS 劫持</div></div></a></span></div><div class="Tag Topic"><span class="Tag-content"><a class="TopicLink" href="//www.zhihu.com/topic/19819717" target="_blank"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">DNS 解析</div></div></a></span></div></div></div><div><div class="Sticky RichContent-actions is-bottom"><div class="ContentItem-actions"><span><button aria-label="赞同 69 " aria-live="polite" type="button" class="Button VoteButton VoteButton--up"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--TriangleUp VoteButton-TriangleUp" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z" fill-rule="evenodd"></path></svg></span>赞同 69</button><button aria-label="反对" aria-live="polite" type="button" class="Button VoteButton VoteButton--down"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--TriangleDown" fill="currentColor" viewBox="0 0 24 24" width="10" height="10"><path d="M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z" fill-rule="evenodd"></path></svg></span></button></span><style data-emotion-css="qbubgm">.css-qbubgm{margin-left:0;}</style><div class="css-qbubgm"><button type="button" class="Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Comment Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z" fill-rule="evenodd"></path></svg></span>14 条评论</button></div><div class="Popover ShareMenu"><div class="ShareMenu-toggler" id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><button type="button" class="Button Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Share Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z" fill-rule="evenodd"></path></svg></span>分享</button></div></div><button aria-live="polite" type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Heart Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M2 8.437C2 5.505 4.294 3.094 7.207 3 9.243 3 11.092 4.19 12 6c.823-1.758 2.649-3 4.651-3C19.545 3 22 5.507 22 8.432 22 16.24 13.842 21 12 21 10.158 21 2 16.24 2 8.437z" fill-rule="evenodd"></path></svg></span>喜欢</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Star Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z" fill-rule="evenodd"></path></svg></span>收藏</button><button type="button" class="Button ContentItem-action Button--plain Button--withIcon Button--withLabel"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Deliver Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5.171 4H18.83a1.5 1.5 0 0 1 1.455 1.136l2.597 10.386a4 4 0 0 1 .119.97V19s0 2-2.002 2H3c-2 0-2-2-2-2v-2.508a4 4 0 0 1 .12-.97L3.715 5.136A1.5 1.5 0 0 1 5.171 4zm1.074 2a1 1 0 0 0-.97.761l-2.123 8.62a.5.5 0 0 0 .486.619h4.717a1 1 0 0 1 .892.548C9.906 17.85 10.824 18.5 12 18.5c1.176 0 2.094-.65 2.753-1.952a1 1 0 0 1 .892-.548h4.717a.5.5 0 0 0 .486-.62l-2.122-8.619A1 1 0 0 0 17.755 6H6.245zM8 9c0-.552.453-1 .997-1h6.006c.55 0 .997.444.997 1 0 .552-.453 1-.997 1H8.997A.996.996 0 0 1 8 9zm-1.5 4c0-.552.445-1 .996-1h9.008c.55 0 .996.444.996 1 0 .552-.445 1-.996 1H7.496a.995.995 0 0 1-.996-1z"></path></svg></span>申请转载</button><div class="Post-ActionMenuButton"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><button type="button" class="Button Button--plain Button--withIcon Button--iconOnly"><span style="display:inline-flex;align-items:center">​<svg class="Zi Zi--Dots Button-zi" fill="currentColor" viewBox="0 0 24 24" width="1.2em" height="1.2em"><path d="M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" fill-rule="evenodd"></path></svg></span></button></div></div></div></div></div></div></article><div class="Post-Sub Post-NormalSub"><div class="PostIndex-Contributions"><h3 class="BlockTitle">文章被以下专栏收录</h3><ul><div class="ContentItem Column-ColumnItem"><div class="ContentItem-main"><div class="ContentItem-image"><a class="ColumnLink" href="//www.zhihu.com/column/c_1145396270574198784"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content"><img class="Avatar Avatar--medium Avatar--round" width="40" height="40" src="https://pic2.zhimg.com/4b70deef7_xs.jpg?source=172ae18b" srcSet="https://pic2.zhimg.com/4b70deef7_l.jpg?source=172ae18b 2x" alt="关于人和科技的思考"/></div></div></a></div><div class="ContentItem-head"><h2 class="ContentItem-title"><a class="ColumnLink ColumnItem-Title" href="//www.zhihu.com/column/c_1145396270574198784"><div class="Popover"><div id="null-toggle" aria-haspopup="true" aria-expanded="false" aria-owns="null-content">关于人和科技的思考</div></div></a></h2></div></div></div></ul></div></div></div></main></div></div><script id="js-clientConfig" type="text/json">{"host":"zhihu.com","protocol":"https:","wwwHost":"www.zhihu.com","videoHost":"video.zhihu.com","fetchRoot":{"www":"https:\u002F\u002Fwww.zhihu.com","api":"https:\u002F\u002Fapi.zhihu.com","lens":"https:\u002F\u002Flens.zhihu.com","zhuanlan":"https:\u002F\u002Fzhuanlan.zhihu.com","walletpay":"https:\u002F\u002Fwalletpay.zhihu.com","captcha":"https:\u002F\u002Fcaptcha.zhihu.com","vzuu":"https:\u002F\u002Fv.vzuu.com","openapi":"https:\u002F\u002Fopenapi.zhihu.com"}}</script><script id="js-initialData" type="text/json">{"initialState":{"common":{"ask":{}},"loading":{"global":{"count":0},"local":{"env\u002FgetIpinfo\u002F":false,"article\u002Fget\u002F":false,"brand\u002FgetUrl\u002F":false}},"club":{"tags":{},"admins":{"data":[]},"members":{"data":[]},"explore":{"candidateSyncClubs":{}},"profile":{},"checkin":{},"comments":{"paging":{},"loading":{},"meta":{},"ids":{}},"postList":{"paging":{},"loading":{},"ids":{}},"recommend":{"data":[]},"silences":{"data":[]},"application":{"profile":null}},"entities":{"users":{"wang-ming-12-38":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c.jpg?source=172ae18b","uid":"41454500052992","userType":"people","isFollowing":false,"urlToken":"wang-ming-12-38","id":"a6c818a0336f8eb90960198fdd1db7f0","description":"","name":"卫sir","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002Fa6c818a0336f8eb90960198fdd1db7f0","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b","isOrg":false,"type":"people","vipInfo":{"isVip":true,"vipIcon":{"url":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4812630bc27d642f7cafcd6cdeca3d7a_r.png?source=172ae18b","nightModeUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c9686ff064ea3579730756ac6c289978_r.png?source=172ae18b"}},"levelInfo":{"exp":12388,"level":4,"nicknameColor":{"color":"","nightModeColor":""},"levelIcon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-8f86c92ac45b818694ebe5d277f11389_l.png","iconInfo":{"url":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-8f86c92ac45b818694ebe5d277f11389_l.png","nightModeUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-378e97600d3f445d1896897f7277d13f_l.png","width":93,"height":51}},"badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"972477022068568064","medalName":"备受瞩目","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-56635eff4121dfc06cf271f46fd700d4_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d1adfc6e446f0712d968ba64cf567370_l.png?source=172ae18b","description":"被 100 个人关注"}}},"questions":{},"answers":{},"articles":{"92899876":{"trackUrl":["https:\u002F\u002Fsugar.zhihu.com\u002Fplutus_adreaper\u002Fcontent_monitor_log?si=__SESSIONID__&ti=__ATOKEN__&at=view&pf=__OS__&ed=BiBUKF0xBSkqGGJ-QhvjYHlDBQ==&idfa=__IDFA__&imei=__IMEI__&androidid=__ANDROIDID__&oaid=__OAID__&ci=__CREATIVEID__&zid=__ZONEID__"],"id":92899876,"title":"一次出人意料而名留青史的DNS投毒攻击","type":"article","articleType":"normal","excerptTitle":"","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F92899876","imageUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-a6eb73389aaeaefde8dfa3bb8c8bbe77_720w.jpg?source=172ae18b","titleImage":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-a6eb73389aaeaefde8dfa3bb8c8bbe77_720w.jpg?source=172ae18b","excerpt":"\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-dc6ff37733af1e447fcf64c5f591b028_200x112.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"276\" data-rawheight=\"320\" data-watermark=\"watermark\" data-original-src=\"v2-dc6ff37733af1e447fcf64c5f591b028\" data-watermark-src=\"v2-e839c50dedeb1edeb114d7a259c9ab80\" data-private-watermark-src=\"\" class=\"origin_image inline-img zh-lightbox-thumb\" data-original=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-dc6ff37733af1e447fcf64c5f591b028_r.jpg\"\u002F\u003E作者：卫剑钒 2008年7月，在互联网上发生了一件极具历史意义的DNS安全事件，该事件一经发布，立即震动了整个互联网，因为，自1983年DNS被发明以来，人们还从未遇到过这类影响深远而易于实现的攻击。Cricket Liu, 《DNS and BIND》（O&#39;Reilly出版）的作者， …","created":1574301834,"updated":1574301834,"author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c.jpg?source=172ae18b","uid":"41454500052992","userType":"people","isFollowing":false,"urlToken":"wang-ming-12-38","id":"a6c818a0336f8eb90960198fdd1db7f0","description":"","name":"卫sir","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002Fa6c818a0336f8eb90960198fdd1db7f0","avatarUrl":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b","isOrg":false,"type":"people","vipInfo":{"isVip":true,"vipIcon":{"url":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-4812630bc27d642f7cafcd6cdeca3d7a_r.png?source=172ae18b","nightModeUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-c9686ff064ea3579730756ac6c289978_r.png?source=172ae18b"}},"levelInfo":{"exp":12388,"level":4,"nicknameColor":{"color":"","nightModeColor":""},"levelIcon":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-8f86c92ac45b818694ebe5d277f11389_l.png","iconInfo":{"url":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-8f86c92ac45b818694ebe5d277f11389_l.png","nightModeUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-378e97600d3f445d1896897f7277d13f_l.png","width":93,"height":51}},"badge":[],"badgeV2":{"title":"","mergedBadges":[],"detailBadges":[],"icon":"","nightIcon":""},"exposedMedal":{"medalId":"972477022068568064","medalName":"备受瞩目","avatarUrl":"https:\u002F\u002Fpic3.zhimg.com\u002Fv2-56635eff4121dfc06cf271f46fd700d4_r.png?source=172ae18b","miniAvatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-d1adfc6e446f0712d968ba64cf567370_l.png?source=172ae18b","description":"被 100 个人关注"}},"commentPermission":"all","copyrightPermission":"need_review","state":"published","imageWidth":650,"imageHeight":432,"content":"\u003Cp\u003E作者：卫剑钒\u003C\u002Fp\u003E\u003Cp\u003E2008年7月，在互联网上发生了一件极具历史意义的DNS安全事件，该事件一经发布，立即震动了整个互联网，因为，自1983年DNS被发明以来，人们还从未遇到过这类影响深远而易于实现的攻击。Cricket Liu, 《DNS and BIND》（O&#39;Reilly出版）的作者， 认为这\u003Cb\u003E可能是互联网历史上最大的一次DNS安全事件。\u003C\u002Fb\u003E[^cory]\u003C\u002Fp\u003E\u003Cp\u003E这个攻击是美国人Dan Kaminsky精心构造的，他本人因此一战成名，该攻击也因此被命名为Kaminsky攻击。\u003C\u002Fp\u003E\u003Cp\u003E漏洞由CERT于2008年7月8日发布[^cert]，但没有公布细节，Dan那时正在协助一些DNS厂商补上这个漏洞，并计划于8月6日在拉斯维加斯召开的Black Hat年度安全大会上披露全部细节内容（然而漏洞细节还是在7月21日被泄漏了出来），由于明明知道有漏洞却又不知道到底怎么回事，当时安全圈内颇有一些人对Dan表示了不满[^circle]。\u003C\u002Fp\u003E\u003Cp\u003E该攻击令人恐惧之处在于，攻击者并不要求有什么特别的条件（比如占据某个路由交换节点可以监听和修改DNS报文），也无需使用社工之类的手段，攻击者就是一个普普通通的网络用户，却可以使用该方法，无差别地在全球复现这个攻击。\u003C\u002Fp\u003E\u003Cp\u003E攻击产生的后果是什么？\u003C\u002Fp\u003E\u003Cp\u003E后果是DNS服务器缓存中的记录被修改（所谓被“投毒”），比如用户本来想访问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，如果本机没有缓存，就会向本地DNS查询该域名的IP，但由于DNS服务器被投毒，所以用户得到的IP并不是想要去的地方，而是一个攻击者设定的IP，这样，用户就被牵引到完全可能是恶意的网站。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E这种对IP的掉包，对搞信息安全的人来讲，哪怕是随便想一想，都会毛骨悚然。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E在用户层面是无法感知和防范这种攻击的，因为攻击破坏了互联网底层的基础设施：域名服务。而域名服务正是那种它不出事时你意识不到它存在，一旦出事都是大事的东西。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E本文将尽量让没有网络基础知识甚至是没有IT基础知识的人看懂。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E了解这个攻击的关键在于了解DNS的原理。\u003C\u002Fp\u003E\u003Ch2\u003E一、DNS基本知识：简单回顾\u003C\u002Fh2\u003E\u003Cp\u003E本章属于扫盲性质，零基础的读者一定不要错过，有基础的同学可以简要掠过。\u003C\u002Fp\u003E\u003Cp\u003E1、我们都知道在互联网上需要用IP的，但事实上，我们在使用的时候，通常输入的是域名而不是IP，比如我们输入\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E或者\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.taobao.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Etaobao.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，这种叫域名，类似39.156.66.18这种，才是IP。\u003C\u002Fp\u003E\u003Cp\u003E2、互联网上传输数据都是要用IP的，\u003Cb\u003EDNS所干的事，就是把域名转换为IP，也即域名解析\u003C\u002Fb\u003E。比如浏览器拿到\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E后，通过DNS系统转换为IP，然后和该IP（比如39.156.66.18）建立通信，交互网页数据并向用户展示。\u003C\u002Fp\u003E\u003Cp\u003E3、互联网上有非常多的域名服务器，共同完成域名解析功能。每个域名服务器内部会记录着一些域名和IP的对应（以及其他一些类似的数据），每条这样的数据称为一个\u003Cb\u003E记录\u003C\u002Fb\u003E。\u003C\u002Fp\u003E\u003Cp\u003E4、不管在我们的电脑上，还是手机上（以下统称为\u003Cb\u003E终端\u003C\u002Fb\u003E），都会设置有DNS服务器的地址（通常被自动配置而无需手工配置），终端需要解析的时候，就去问它，它如果知道答案，就直接回复；如果不知道，就去网上问，最终会把答案（也即那个IP）返回给终端。这个DNS服务器常被称为本地DNS，它可能确实在家里、企业里、机场里、咖啡馆里，也有可能不在本地，比如114.114.114.114或者8.8.8.8这样的公用DNS服务器。\u003C\u002Fp\u003E\u003Cp\u003E5、本地DNS可能是一个递归DNS，也可能只是一个DNS代理。递归DNS会不厌其烦地在互联网上尽力完成解析然后把结果返回终端，代理则只是把终端的请求转发给给真正干活的递归DNS，然后把递归DNS的答案转发给终端。\u003Cb\u003E本文为描述方便，略去DNS代理这种简单的情况，不再区分本地DNS和递归DNS，将其统一简写为LDNS\u003C\u002Fb\u003E。\u003C\u002Fp\u003E\u003Cp\u003E6、最主要的DNS服务器就两种：递归DNS服务器和权威DNS服务器，为什么称之为“权威”，是因为它说了算，他说哪个域名对应哪个IP就是哪个IP。\u003C\u002Fp\u003E\u003Cp\u003E7、LDNS如果已经通过查询得到了一个域名的IP，就会把它记在\u003Cb\u003E缓存\u003C\u002Fb\u003E里，下次再有人问这个域名，LDNS直接回复缓存里的答案即可。缓存只要不过期就可继续使用，过期后需要重新去网上查询。\u003C\u002Fp\u003E\u003Cp\u003E基本知识就说到这里，DNS服务器还有其他一些类型（比如镜像域名服务器、唯缓存DNS服务器等），由于并不影响对攻击的理解，在此就略过不做介绍。\u003C\u002Fp\u003E\u003Ch2\u003E二、对攻击的原理性解释\u003C\u002Fh2\u003E\u003Cp\u003E最精简的解释：\u003Cb\u003E攻击者通过精心构造DNS报文，在LDNS查询某个域名时，冒充真正的权威DNS做出回应，使得LDNS得到一个虚假响应。如果LDNS接受了这个虚假响应并写入缓存，LDNS就会中毒。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E一个LDNS通常为多个用户服务，比如一个公司所有用户会使用相同的LDNS，再如ISP提供的LDNS，或者像8.8.8.8这种公用LDNS，更是为大量用户提供服务，所以LDNS一旦中毒，受害面就会很大。\u003C\u002Fp\u003E\u003Cp\u003E成功实现这个攻击并不容易，否则Kaminsky也不会被载入史册。\u003C\u002Fp\u003E\u003Cp\u003E攻击者要能在LDNS发出域名查询后，在真正的响应返回前，迅速发出多个伪造的响应包，以便让LDNS能够接受其中一个，如果成功，真正的响应将会被LDNS抛弃，因为来得太晚了，这次DNS查询已经结束了。\u003C\u002Fp\u003E\u003Cp\u003E为了彻底搞明白Kaminsky攻击，我们需要有一些基础知识。\u003C\u002Fp\u003E\u003Cp\u003E下面横线之间的部分是零基础读者需要看的，了解IP、UDP、端口等基本概念的读者可以直接略过。\u003C\u002Fp\u003E\u003Chr\u002F\u003E\u003Cp\u003EDNS通常使用UDP包传输数据，从关系上讲，IP包里承载着UDP数据报，UDP数据报里承载着DNS报文，就像下面这样：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E[IP包头[UDP报头[DNS数据报文]]]\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E\u003Cb\u003E在IP包头中，最重要的数据是源IP地址和目的IP地址。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E在LDNS向某个权威DNS发送查询包时，源IP地址就是LDNS的IP地址，目的IP地址就是权威DNS的IP地址。\u003C\u002Fp\u003E\u003Cp\u003E当权威DNS回应时，响应包中的目的IP为LDNS，源IP为权威DNS的IP，正好反过来了。\u003C\u002Fp\u003E\u003Cp\u003E攻击者得到权威DNS的IP并不难，然后就可以用这个IP伪造是权威DNS发出的包了。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E在UDP报头里，最重要的是源端口和目的端口。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E这里简要介绍一下什么是端口，我们知道每台服务器至少会有一个IP地址，但这个IP上会跑多个程序，如果只有IP概念而没有端口概念的话，当一个IP包送到这个IP对应的服务器时，操作系统就不知道将这个包送给哪个程序。\u003C\u002Fp\u003E\u003Cp\u003E有了端口的概念，就可以区分一个IP上的多个程序了，比如通常一个web server会在80端口等待数据包，一个SSH服务会在22端口等待数据包，所以说，目的端口号，事实上指定了要获取的服务。\u003C\u002Fp\u003E\u003Cp\u003EDNS服务器是在53号端口等待服务的，如果权威DNS同时还提供了web服务（比如一个管理DNS的web界面），那么该服务器收到端口号是80的包，就会送给web server，收到端口号为53的包，就会送给name server（也即DNS）。\u003C\u002Fp\u003E\u003Cp\u003E就像源IP、目的IP一样，源端口、目的端口在查询包和响应包中是反过来的，响应包中的目的端口正是查询包中的源端口，响应包中的源端口正是查询包中的目的端口。由于DNS查询包的目的端口是53，所以响应包的源端口就是53。\u003C\u002Fp\u003E\u003Cp\u003E基础中的基础介绍到此为止。\u003C\u002Fp\u003E\u003Chr\u002F\u003E\u003Cp\u003E下面介绍一下DNS报文的结构，这个也属于基础知识，但如果不是专门搞DNS的，大多数人即便专门了解过，都不太会记得，因为没事的时候没人关心这个。\u003C\u002Fp\u003E\u003Cp\u003EDNS查询报文和响应报文的格式是一样的，可以很精简地写成下面的样子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EDNS报文：|QID|问题区|应答区|权威区|附加区|\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E先看下最前面那个QID，QID即查询ID，是用于匹配查询报文和相应报文的，LDNS每次向外发出DNS查询报文，都会设置一个不同的QID，原因是同一时刻可能会有多个查询，有了QID，可以方便地把响应和查询匹配起来（响应报文中会填写和对应查询一致的QID）。\u003C\u002Fp\u003E\u003Cp\u003E至于QID之后的4个区是做什么用的，后面再介绍。\u003C\u002Fp\u003E\u003Cp\u003E为什么需要了解这些基础知识，是因为LDNS在发出查询包后，只接受它意欲等待的响应包，对于IP不对的、端口不对的，格式不对的、QID不对的，域名不对的，应答不对的，以及其他各种莫名其妙的包，都会被LDNS抛弃。\u003C\u002Fp\u003E\u003Cp\u003E那么攻击者要怎么才能通过这些检查呢？\u003C\u002Fp\u003E\u003Cp\u003E主要的几个难点是：\u003C\u002Fp\u003E\u003Cp\u003E1、攻击者要能知道LDNS发出UDP报头中的源端口。攻击者不能窃听，所以这并不容易获取，好在2008年的时候，很多LDNS的实现并不重视源端口的随机化，有的LDNS直接使用53作为源端口，有的LDNS由操作系统选择的一个固定的值，有的则是对同一个终端用户采用同一个源端口，当然，也有很谨慎的LDNS（如djbdns），每次DNS查询都使用不同的端口号。\u003C\u002Fp\u003E\u003Cp\u003E2、DNS报文中的查询ID（QID）要对得上，2008年的时候，QID早已实现了随机化，所以攻击者要匹配上QID，是需要点功夫的。\u003C\u002Fp\u003E\u003Cp\u003E3、DNS报文中各个数据区中的内容，要能被LDNS认可和接受，后面我们会看到，这需要精通DNS原理并花心思精心设计。\u003C\u002Fp\u003E\u003Ch2\u003E三、是时候介绍DNS原理了\u003C\u002Fh2\u003E\u003Cp\u003E下面的描述先不考虑有缓存的情况，而是考虑从头来过查询一个域名。\u003C\u002Fp\u003E\u003Cp\u003E比如要查询\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这个的域名，LDNS会怎么做呢，去哪里问？\u003C\u002Fp\u003E\u003Cp\u003E有那么一台集中的、统一的、无所不知的、永远正确的域名服务器吗？\u003C\u002Fp\u003E\u003Cp\u003E显然没有。\u003C\u002Fp\u003E\u003Cp\u003E全世界的域名太多了，集中统一管理的成本太高、弊端也太多，在互联网上，是不会这么做的。\u003C\u002Fp\u003E\u003Ch3\u003E（一）递归DNS所采用的递归式查询到底是什么样的\u003C\u002Fh3\u003E\u003Cp\u003E域名服务器是层级式管理的，也即有多层DNS，最高一层是“根DNS”，然后接下来的是“顶级域名DNS”，根DNS负责回答顶级域名DNS（也即一级域名DNS）在哪里，顶级域名DNS负责回答二级域名DNS在哪里，二级域名DNS负责回答三级域名DNS在哪里……\u003C\u002Fp\u003E\u003Cp\u003E上面这些都是权威DNS（因为他们对自己负责范围的应答都是权威的）。\u003C\u002Fp\u003E\u003Cp\u003E（注意也有人把\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E叫做一级域名，把\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fabc.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eabc.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这种叫做二级域名的，确实存在一些混乱，但对理解本文无关紧要。）\u003C\u002Fp\u003E\u003Cp\u003E举个例子，你拿\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E问root(根DNS)，root告诉你去问com的权威DNS（顶级域名DNS），com告诉你去问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的权威DNS(即二级域名DNS)，后面我们会看到，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E又让你去问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fshifen.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eshifen.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，总之，就这么不断往复的问下去，最终，你会问到\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的IP。\u003C\u002Fp\u003E\u003Cp\u003E这就是一个递归的过程。\u003C\u002Fp\u003E\u003Cp\u003E下面说的稍微详细一点：\u003C\u002Fp\u003E\u003Cp\u003E1、LDNS问根DNS说“\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的IP是多少呀”。\u003C\u002Fp\u003E\u003Cp\u003E2、根DNS是不会直接给出答案的，因为它很忙，不会管这么具体的事，但它记录着.com  .cn  .net  .org  .edu  .gov  .us  .hk  .jp这些顶级域的权威DNS在哪里，所以它回答说“你先去问com顶级域的DNS吧，我只管到顶级域，诺，这些是com顶级域名DNS的名字（本身也是个域名）和IP，你去问它们吧”，这其实就是给出了下一步问询的对象（referral）。\u003C\u002Fp\u003E\u003Cp\u003E3、然后LDNS向com的权威DNS发出请求，它记录着\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ftaobao.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Etaobao.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fgoogle.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Egoogle.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这些二级域的权威DNS在哪里，它回答LDNS说：“你去问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的DNS吧，他掌管着\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这个域的解析，他会告诉你答案，他的名字是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，他的IP是……”。（事实上会给出多个名字和IP，比如\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns2.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens2.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E等等和对应的IP）\u003C\u002Fp\u003E\u003Cp\u003E注：这里出现一个概念叫“域”（zone），这是什么东西？这其实就是域名中不同长度的以.分割的后缀，比如com是个域，它是顶级域，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ftaobao.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Etaobao.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fqq.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eqq.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fgoogle.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Egoogle.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E作为com的子域，称为二级域，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fabc.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eabc.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E（举例而已，未必有这个域）这种是三级域。\u003C\u002Fp\u003E\u003Cp\u003E4、LDNS会继续问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E（事实上有多个），它负责这个域下面三级域名如\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fzhidao.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ezhidao.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwenku.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ewenku.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fimage.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eimage.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ftieba.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Etieba.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fmap.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Emap.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的解析。\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E会给出答案，可能会直接给出IP（即A记录），也可能会给出一个CNAME记录。\u003C\u002Fp\u003E\u003Cp\u003E等等，这是什么？\u003C\u002Fp\u003E\u003Cp\u003E现在我们需要了解最常见的几种DNS记录。\u003C\u002Fp\u003E\u003Ch3\u003E（二）最常见的三种DNS记录\u003C\u002Fh3\u003E\u003Cp\u003E\u003Cb\u003EDNS记录是用于解析的数据，最常见的3种记录为：NS记录、A记录、CNAME记录。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Ch3\u003E第一种：NS记录\u003C\u002Fh3\u003E\u003Cp\u003E如果DNS给你回应一条NS记录，就是告诉你，这个家伙是某个域的权威DNS，有事你去问它。\u003C\u002Fp\u003E\u003Cp\u003E比如在com的DNS里，记录着\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这个域的DNS，长的大概是这个样子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ebaidu.com.  NS  ns1.baidu.com.\nbaidu.com.  NS  ns2.baidu.com.\nbaidu.com.  NS  ns3.baidu.com.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这三条记录，就是说\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns2.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens2.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns3.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens3.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E(以下简称ns1、ns2、ns3)都是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E域的权威DNS，问任意其中一个都可以（一般都是顺序问的，如果连不上第一个，就去找第二个）。\u003C\u002Fp\u003E\u003Cp\u003E注意，域名后面会比我们平时见到的多一个“.”，这就代表了根，严格地说，所有域名后面都应该有这一个“.”的，比如完整的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E域名应该是www.baidu.com.，也可以把所有域名都看作有一个.root的后缀，比如www.baidu.com.root，但由于每个域名都有这个后缀，所以干脆就都省略了。（本文后面也都会省略这个“.”）\u003C\u002Fp\u003E\u003Cp\u003E当然，在com的权威DNS里，还会记录ns1~ns3这几个\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E权威DNS的IP，会一并返回给问询者，以便问询者直接用IP联系ns1～ns3。\u003C\u002Fp\u003E\u003Ch3\u003E第二种：A记录\u003C\u002Fh3\u003E\u003Cp\u003EA记录就是最经典的域名和IP的对应，在\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E里面，记录着百度公司各产品的域名和IP的对应关系，每一个这样的记录，就是一个A记录，比如下面的3个A记录（随意举的例子，IP都是随意写的）。\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Eimage.baidu.com     A       1.2.3.4\nwenku.baidu.com     A       5.6.7.8\ntieba.baidu.com     A       9.10.11.12\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E如果有人问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E：“\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwenku.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ewenku.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的IP是多少？”，ns1就会找到对应的A记录或者CNAME记录并返回。\u003C\u002Fp\u003E\u003Ch3\u003E第三种：CNAME记录\u003C\u002Fh3\u003E\u003Cp\u003E这种记录比较有趣，你问DNS一个域名，它回CNAME记录，意思是说，你要解析的这个域名，还有另一个域名(也就是别名)，你去解析那个好了。\u003C\u002Fp\u003E\u003Cp\u003E比如，在ns1中，其实并没有\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，而是一个CNAME记录：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ewww.baidu.com       CNAME   www.a.shifen.com\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这就是在告诉LDNS，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的别名是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.a.shifen.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ea.shifen.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，去解析\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.a.shifen.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ea.shifen.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E吧！\u003C\u002Fp\u003E\u003Cp\u003E然后LDNS再发起一次针对这个别名的解析，直到最终获得A记录拿到IP。\u003C\u002Fp\u003E\u003Ch3\u003E(三）关于缓存\u003C\u002Fh3\u003E\u003Cp\u003E前面的介绍都没有涉及缓存，所以那些过程都是一个理论上的过程，有了缓存以后，你会发现，实际过程和理论过程相差甚远。\u003C\u002Fp\u003E\u003Cp\u003E缓存不仅仅存在于LDNS中，也存在于操作系统中、浏览器中、以及一些应用中。按道理，缓存的时间应该以权威DNS返回记录中的TTL（存活时间）为准，但事实上，根据应用、浏览器、操作系统自己的喜好，一般都会有所调整，而不是完全按照TTL来做的。\u003C\u002Fp\u003E\u003Cp\u003E上面的那些例子中，为了简洁起见，没有列出TTL，事实上，一个完整的记录大概是这个样子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003Ebaidu.com.      86400   IN  NS  ns3.baidu.com.\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E其中的86400就是TTL，是以秒为单位的，86400也就是24小时即1天。\u003C\u002Fp\u003E\u003Cp\u003E其中的“IN”指的是互联网类型的域名，通常都是如此，还有一种类型是“CHAOS”，几乎没用。\u003C\u002Fp\u003E\u003Cp\u003E有了缓存以后，一个域名的解析，就不再是前面介绍的那种从根问起的过程了，举个例子，比如在浏览器中输入\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F123.abc.qq.com.cn\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E123.abc.qq.com.cn\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回，如果没有，就去问操作系统，操作系统也会去看自己的缓存，如果没有，再去hosts文件看，也没有，才会去问LDNS。\u003C\u002Fp\u003E\u003Cp\u003ELDNS会去先看看自己有没有\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F123.abc.qq.com.cn\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E123.abc.qq.com.cn\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，要有就直接返回，要没有，就去看有没有\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fabc.qq.com.cn\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eabc.qq.com.cn\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的NS记录，如果有，就去问它要答案，如果没有，就去看有无\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fqq.com.cn\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eqq.com.cn\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的NS的记录，如果有，就去问它，没有就去看有无\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fcom.cn\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ecom.cn\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的DNS，还没有就去看有无cn的DNS，如果连cn的DNS都找不到，才去问根。\u003C\u002Fp\u003E\u003Cp\u003E所以你看，有了缓存以后，前面讲的那种从根问起的情况，事实上是很少的。\u003C\u002Fp\u003E\u003Ch3\u003E（四）DNS报文内容\u003C\u002Fh3\u003E\u003Cp\u003E现在，到了DNS原理的最后时刻了……\u003C\u002Fp\u003E\u003Cp\u003E再看一眼DNS报文结构：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E|QID|问题区|应答区|权威区|附加区|\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E查询报文（以下简称查询包）只是填写QID和问题区（也即要问什么），后面几个区不用填写内容。\u003C\u002Fp\u003E\u003Cp\u003E响应报文（以下简称响应包）会填写QID（和对应查询包中的QID一致）、问题区（和对应查询包中的问题一致），还会填写后面几个区：应答区、权威区（也即填写权威DNS的区域，）、附加区。\u003C\u002Fp\u003E\u003Cp\u003E这几个区的主要作用是：\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E问题区\u003C\u002Fb\u003E（Question Section）：这里填写所要查询的问题（可以是一个或多个），主要填查询内容和查询类型，比如想要查\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，就填\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E和A。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E应答区\u003C\u002Fb\u003E（Answer Section）：这里给出查询问题的答案，对于A记录类型的问题，这里会给出一个或多个A记录，也可能给出一个或多个CNAME记录。当然，如果问题问的是NS记录，这里就会应答NS记录。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E权威区\u003C\u002Fb\u003E（Authority Section）：这里给出一个或多个NS记录，其实就是那些referral，也即告诉LDNS问谁会更接近答案一些，比如com的DNS会在这里给出\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的权威DNS（可以给出多个）。注意，在必要情况下，权威DNS在应答区给出回答的同时，还会在权威区给出NS记录。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E附加区\u003C\u002Fb\u003E（Additional Section）：这里存放附加的一些记录。比如在给出权威NS记录的同时，会把它的A记录放在这里（在NS记录中是不会有IP的），这样做的好处是可以解决鸡生蛋蛋生鸡的问题，比如你查\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，权威告诉你去找\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，如果没有这个附加的A记录（又称胶水记录，glue record），你就得去问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，然后权威又告诉你去找\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.baidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，这就进入一个无解的循环之中。\u003C\u002Fp\u003E\u003Cp\u003E前面讲，LDNS查询\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbaidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的权威DNS可能会回一个A记录，也可能回一个CNAME记录，具体如何？我们实际看一下。\u003C\u002Fp\u003E\u003Cp\u003E查询包大约是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EQID：6012\n问题区：  www.baidu.com A\n应答区：（空）\n权威区：（空）\n附加区：（空）\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E通过抓包，可以看到响应包大约是这样的：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003EQID：6012\n问题区：www.baidu.com A\n应答区：www.baidu.com.  CNAME   www.a.shifen.com.\n权威区：\n        a.shifen.com.       NS  ns1.a.shifen.com.\n            a.shifen.com.       NS  ns2.a.shifen.com.\n附加区：\n        ns2.a.shifen.com.   A   61.135.165.224\n        ns2.a.shifen.com.   A   220.181.33.32\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E由于得到的是CNAME记录，LDNS为了得到IP，还会继续发起对\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.a.shifen.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ea.shifen.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的查询，最终获得其IP。\u003C\u002Fp\u003E\u003Cp\u003E现在，有了这些基础知识，基本上就差不多了，我们看看Kaminsky攻击是怎么做到的。\u003C\u002Fp\u003E\u003Ch2\u003E四、对攻击的详细解释\u003C\u002Fh2\u003E\u003Cp\u003E首先明确一下攻击目标和限制条件：\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E攻击目标：\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E更改LDNS的缓存：使得其中关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的对应IP改为攻击者希望的IP。（foo只是一个例子，你可以自行在这里把foo脑补为baidu、taobao、google等等。）\u003C\u002Fp\u003E\u003Ch3\u003E\u003Cb\u003E攻击条件和限制：\u003C\u002Fb\u003E\u003C\u002Fh3\u003E\u003Cp\u003E攻击者无法监听LDNS发出和接收的网络数据，无法截断和篡改LDNS发出和接收的网络数据，无法通过各种攻击直接获取LDNS缓存的读写能力。\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E其实，这就是一个普普通通攻击者在网络上的真实能力。\u003C\u002Fb\u003E\u003C\u002Fp\u003E\u003Cp\u003E比较一般的攻击思路大约是这样：\u003C\u002Fp\u003E\u003Cp\u003E在LDNS发出关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的查询请求时，攻击者想方设法发送伪造的响应包并尽快回应（要比真正的响应包快一步送达），该伪造的响应包里面，有伪造的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，A记录里的IP是攻击者想伪造的IP，只要该报文被LDNS接收，并且把其中相关的记录记入缓存，目标即达成。\u003C\u002Fp\u003E\u003Cp\u003E后面我们会看到，这种思路只有一部分是对的，直接伪造\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录并不可行，至少缓存这关会过不去。\u003C\u002Fp\u003E\u003Ch3\u003E攻击成功的4个关键点\u003C\u002Fh3\u003E\u003Cp\u003E1、要把握住时机，要能控制或知道什么时候LDNS发出针对某个域名的查询包。\u003C\u002Fp\u003E\u003Cp\u003E2、响应包中的目的端口正是查询包里的源端口。\u003C\u002Fp\u003E\u003Cp\u003E3、响应包中的QID也是对的。\u003C\u002Fp\u003E\u003Cp\u003E4、响应包中的记录被LDNS接受并计入缓存。（这是最重要的）\u003C\u002Fp\u003E\u003Ch3\u003E先看第一个关键点，如何把握时机？\u003C\u002Fh3\u003E\u003Cp\u003E在我们的假设中，攻击者是可以获取LDNS服务的，那么只要攻击者作为终端用户，向LDNS提出解析请求，就有可能让LDNS向外发起查询，然后攻击者就可以立刻回应伪造的包（这就会比权威DNS快，毕竟权威DNS是收到查询包后才响应的），这就好比攻击者掌握着“发令枪”，所以在这个竞赛中，攻击者比真正的权威DNS有优势的。\u003C\u002Fp\u003E\u003Ch3\u003E关于第二个关键点，UDP源端口如何匹配？\u003C\u002Fh3\u003E\u003Cp\u003E前面提到过，在发出查询的时候，大多数流行的LDNS使用了相对固定的UDP源端口，对攻击者而言，这就好办多了。\u003C\u002Fp\u003E\u003Cp\u003E具体的做法可以是，攻击者让LDNS先查询一次自己控制的域名比如\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fbadguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebadguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，由于自己控制着这台服务器，在服务器上抓包或者直接通过源码打印输出，就可以知道LDNS所使用的UDP源端口了。\u003C\u002Fp\u003E\u003Cp\u003E在2008年那个时候，BIND、微软的MSDNS、Nominum等LDNS都存在这个问题，但djbdns、PowerDNS、 MaraDNS没有这个问题（它们在设计时就使用了随机的源端口），但显然BIND和MSDNS在当时是使用最广泛的LDNS。\u003C\u002Fp\u003E\u003Ch3\u003E关于第三个关键点，QID如何匹配？\u003C\u002Fh3\u003E\u003Cp\u003ELDNS每发出一次查询，其QID都是不同的，QID字段大小16位，所以一共会有65536个值。\u003C\u002Fp\u003E\u003Cp\u003E早期的LDNS实现中，不用拍脑袋都可以想象，程序员当然是下意识按照递增+1的方式来变化QID的，但在1997年，人们发现这容易被攻击者猜测到[^joe]，所以大多数LDNS的实现中，早已实现了QID的随机化，在2008年，攻击者要想拿出正确的QID，只能靠猜。\u003C\u002Fp\u003E\u003Cp\u003E现实中，攻击者面临的巨大困难是：如果LDNS已经有关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的缓存，那么只有在缓存过期的时候，才会向外发出关于该域名的查询，如果这个缓存有效期是1天，那就需要等上1天才能够发起一次攻击，因为在这一天内，LDNS都是直接在缓存中取答案的，根本不需要向外发起解析。\u003C\u002Fp\u003E\u003Cp\u003E假设攻击者在真正的响应包返回前能有100次的猜测机会（猜错的会被抛弃，猜对的会被接收），由于缓存的存在，那么他平均需要1天*65536\u002F100*1\u002F2的时间（327天）才能成功[^dmk]。\u003C\u002Fp\u003E\u003Cp\u003EDan Kaminsky所使用的方法可没有这么笨，Dan不会去等待缓存失效的，他会让主动让LDNS发起一次域名查询，\u003Cb\u003E这正是Dan的攻击方法中最创新的一点\u003C\u002Fb\u003E：\u003C\u002Fp\u003E\u003Cp\u003EDan会去问类似\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F2.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E2.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F3.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E3.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E等等这些大概率就完全不存在的域名，由于LDNS并没有这些域名的缓存，就会发起查询，假设\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ffoo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的权威DNS，LDNS就会去\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns1.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens1.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E询问，由于Dan每发一个这样的包，LDNS都会去问一次，攻击者也就有一次猜测的机会。\u003C\u002Fp\u003E\u003Cp\u003E通常，使用这种方法，大约不到10秒就可以猜测QID成功！[^steve]\u003C\u002Fp\u003E\u003Cp\u003E假设，终于在发送到\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F83.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E83.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的时候，攻击者的QID正好和LDNS发出查询包中的那个QID一样，这时，源端口和QID都对了，攻击几乎就要成功了！\u003C\u002Fp\u003E\u003Ch3\u003E最后一个关键点，如何让LDNS接受内容？\u003C\u002Fh3\u003E\u003Cp\u003E肯定有人会问，我们要投毒的是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，搞定\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F83.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E83.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E有什么意义啊。\u003C\u002Fp\u003E\u003Cp\u003E没错，我们的目标并不是\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F83.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E83.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，这个攻击比较精彩的地方是，Dan并不是在应答区做手脚，而是在权威区和附加区行骗！\u003C\u002Fp\u003E\u003Cp\u003EDan伪造的响应包，大约是这个样子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区：83.foo.com  A\n应答区：（空）\n权威区：foo.com  NS www.foo.com\n附加区：www.foo.com  A 6.6.6.6\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这个响应的意思是：“我不知道\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F83.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E83.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，你去问问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E吧，它负责\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ffoo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这个域，对了，他的IP是6.6.6.6”。\u003C\u002Fp\u003E\u003Cp\u003E而这里的6.6.6.6，就是攻击者意欲让LDNS相信的IP地址。\u003C\u002Fp\u003E\u003Cp\u003E不太熟悉DNS的读者可能会觉得奇怪，\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E也可以是一个DNS的名字？当然可以，有哪个标准说过，域名服务器非要起\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E这样的名字呢，只要是个域名就可以了。\u003C\u002Fp\u003E\u003Cp\u003E没有任何毛病，LDNS当然会接受这个NS记录，以及后面的这个胶水记录（就是那个A记录），大功告成！\u003C\u002Fp\u003E\u003Cp\u003E这样的攻击，不仅污染了\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，还污染了整个\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Ffoo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E域，因为之后所有此域下的解析，在缓存有效期内，都会去问6.6.6.6，也即问到攻击者那里！（缓存失效后可以再次发起攻击）\u003C\u002Fp\u003E\u003Ch3\u003E前面没有提及的bailiwick检查\u003C\u002Fh3\u003E\u003Cp\u003E这个攻击之所以出人意料，在于他能通过bailiwick检查，DNS投毒（或者说缓存污染）并不是新鲜事，bailiwick检查被设计出来专门防范缓存污染，主要原则是：如果检查发现附加区中的记录和问题区中的问题不在同一个域管辖之下，就会格外谨慎而不会采信（更不会记入缓存）此记录，这可以防范恶意权威DNS发出虚假的记录以污染缓存。\u003C\u002Fp\u003E\u003Cp\u003E为了理解bailiwick检查，可以看一个简单的例子：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区:\n    www.foo.com  A 1.2.3.4\n权威区:\n    foo.com     NS  ns1.foo.com\n附加区:\n    ns1.foo.com A 2.3.4.5\n    www.bar.com A 6.6.6.6\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E上面例子中，用户请求\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的时候，响应包里出现关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.bar.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebar.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的记录，DNS将根据bailiwick检查规则，不会接受将此A记录。更多关于bailiwick检查的知识可见本文参考资料[^shmat]。\u003C\u002Fp\u003E\u003Cp\u003Ebailiwick检查自1997年就已经被普遍重视和实现了，在人们觉得普通攻击者很难实现缓存污染的情况下，Kaminsky攻击横空出世，所以颇令人震惊。\u003C\u002Fp\u003E\u003Ch3\u003E更进一步？\u003C\u002Fh3\u003E\u003Cp\u003E现在考虑让攻击更激进一点，攻击一个不对外提供服务的企业内部的LDNS。\u003C\u002Fp\u003E\u003Cp\u003E上面的讲解中，攻击者本身是LDNS的一个客户，所以攻击者可以任意地发出解析请求。如果LDNS位于企业内部不向攻击者提供服务呢。\u003C\u002Fp\u003E\u003Cp\u003EDan在黑帽大会的演讲中，指出有很多种方法可以突破，这里举其中一个比较浅显的例子：比如设法让企业内部的人浏览一个含有很多链接的网页，这些链接分别指向\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E（badguy是被攻击者控制的域名）、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F2.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E2.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F3.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E3.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E、\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F4.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E4.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E……等等，一旦\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fns.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ens.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E收到关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的解析请求，他就知道该网页开始被浏览了，针对\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.badguy.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.badguy.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E请求，它会回一个：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区：1.badguy.com  A  \n应答区：（空）\n权威区：badguy.com  NS  1.foo.com\n附加区：（空）\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这是一个典型的“去问别人吧”（refrral）回应，也即告诉LDNS去问\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E，攻击者知道，LDNS收到这个响应后，会发起关于\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002F1.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003E1.foo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的查询，所以攻击者立刻发送一波伪造的响应给LDNS，这些响应使用不同的QID来猜测，内容则是：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区：1.foo.com  A  \n应答区：（空）\n权威区：foo.com NS www.foo.com\n附加区：www.foo.com  A   6.6.6.6\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E看到这里，你就明白，这就和前面的攻击模式一样了。\u003C\u002Fp\u003E\u003Cp\u003E也许又是在第83次，攻击者又成功了～\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区：83.foo.com  A  \n应答区：（空）\n权威区：foo.com NS www.foo.com\n附加区：www.foo.com A 6.6.6.6\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E攻击者为什么不一开始就直接像下面这样回应呢：\u003C\u002Fp\u003E\u003Cdiv class=\"highlight\"\u003E\u003Cpre\u003E\u003Ccode class=\"language-text\"\u003E问题区：1.badguy.com  A  \n应答区：（空）\n权威区：badguy.com NS www.foo.com\n附加区：www.foo.com  A   6.6.6.6\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\u003Cp\u003E这样难道不是更直接更迅速吗？都不用猜QID了。\u003C\u002Fp\u003E\u003Cp\u003E这样做是不行的，就像前面说的，大多数LDNS都有做bailiwick检查，由于附加区的记录和问题区的问题不在一个域，LDNS会弃这个A记录不用，而是针对\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E发起另一次查询。\u003C\u002Fp\u003E\u003Cp\u003EDan在他的Black Hat演讲PPT中还给出了其他一些方法，有兴趣的可以下载来看一下，这篇PPT着实非常精彩，作者要说的话基本都体现在PPT上，即便没有解说，也完全能够看懂。\u003C\u002Fp\u003E\u003Cp\u003E以上就是对Dan kaminsky攻击的介绍。\u003C\u002Fp\u003E\u003Ch2\u003E五、针对攻击的漏洞修补\u003C\u002Fh2\u003E\u003Cp\u003E1、就像1997年普遍实现QID随机化那样，要让UDP源端口也实现真正的随机化（当然不能是伪随机数！），这会让攻击难度显著提升，在最好的情况下，攻击者要攻击的随机数空间达到65536*65536，虽然在一般的实现中，不会用尽这么大的空间。比如，2008年，微软将自己的DNS服务器更新为使用2500个UDP源端口6。\u003C\u002Fp\u003E\u003Cp\u003E2、继续确保严格的Bailiwick检查，并采取更谨慎的态度和做法。比如在BIND9的实现中，如果缓存中有来自应答区的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录，那么来自附加区的\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.foo.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Efoo.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的A记录将不能覆盖前者。\u003C\u002Fp\u003E\u003Cp\u003E3、David Dagon提出了一种比较有趣的思路[^dagon]，可以了解一下，就是LDNS在向外发出查询时，所查询域名中每个字母的大小写随机安排，比如查询域名\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.baidu.com\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ebaidu.com\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E的时候，问题写为\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002FwWW.bAIdU.cOM\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003EwWW.bAIdU.cOM\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E或者\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002FWwW.baIDU.CoM\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003EWwW.baIDU.CoM\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E等等（域名本身是大小写不敏感的），并且要求响应包中的问题和此匹配，这使得攻击者不仅要匹配源端口、QID，还要匹配这个写法，增加了猜测难度。\u003C\u002Fp\u003E\u003Cp\u003E4、一些并未得到广泛采用的手段，比如限制用户在短时间内发起大量的DNS查询。\u003C\u002Fp\u003E\u003Cp\u003E5、一些尚未得到普遍实施的安全机制，如DNSSEC、DNS over HTTPS等。\u003C\u002Fp\u003E\u003Cp\u003E参考资料：\u003C\u002Fp\u003E\u003Cp\u003E[^cert]: Multiple DNS implementations vulnerable to cache poisoning (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.kb.cert.org\u002Fvuls\u002Fid\u002F800113\u002F\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ekb.cert.org\u002Fvuls\u002Fid\u002F800\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E113\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^dmk]: It’s The End Of The Cache As We Know It (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.slideshare.net\u002Fdakami\u002Fdmk-bo2-k8\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eslideshare.net\u002Fdakami\u002Fd\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Emk-bo2-k8\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^steve]: An Illustrated Guide to the Kaminsky DNS Vulnerability (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.unixwiz.net\u002Ftechtips\u002Figuide-kaminsky-dns-vuln.html\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eunixwiz.net\u002Ftechtips\u002Fig\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Euide-kaminsky-dns-vuln.html\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^cory]: Understanding Kaminsky&#39;s DNS Bug ( \u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.linuxjournal.com\u002Fcontent\u002Funderstanding-kaminskys-dns-bug\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Elinuxjournal.com\u002Fconten\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Et\u002Funderstanding-kaminskys-dns-bug\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E )\u003C\u002Fp\u003E\u003Cp\u003E[^circle]: Not a Guessing Game (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.circleid.com\u002Fposts\u002F87143_dns_not_a_guessing_game\u002F\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ecircleid.com\u002Fposts\u002F8714\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E3_dns_not_a_guessing_game\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^shmat]: The Hitchhiker’s Guide to DNS Cache Poisoning (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fwww.cs.cornell.edu\u002F~shmat\u002Fshmat_securecomm10.pdf\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Ecs.cornell.edu\u002F~shmat\u002Fs\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Ehmat_securecomm10.pdf\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^Joe]: DNS Cache Poisoning - The Next Generation (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=http%3A\u002F\u002Fwww.ouah.org\u002FDNScp.htm\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttp:\u002F\u002Fwww.\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eouah.org\u002FDNScp.htm\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E[^dagon]: Increased DNS forgery resistance through 0x20-bit encoding (\u003Ca href=\"https:\u002F\u002Flink.zhihu.com\u002F?target=https%3A\u002F\u002Fastrolavos.gatech.edu\u002Farticles\u002Fincreased_dns_resistance.pdf\" class=\" external\" target=\"_blank\" rel=\"nofollow noreferrer\"\u003E\u003Cspan class=\"invisible\"\u003Ehttps:\u002F\u002F\u003C\u002Fspan\u003E\u003Cspan class=\"visible\"\u003Eastrolavos.gatech.edu\u002Fa\u003C\u002Fspan\u003E\u003Cspan class=\"invisible\"\u003Erticles\u002Fincreased_dns_resistance.pdf\u003C\u002Fspan\u003E\u003Cspan class=\"ellipsis\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003E)\u003C\u002Fp\u003E\u003Cp\u003E感谢微信号 @king432287 @simonzhao7727 @diifee @wenzel 在本文撰写过程中予以的答疑解惑。\u003C\u002Fp\u003E\u003Cp\u003E本文采用\u003Cb\u003E知识共享“署名-相同方式共享”4.0国际许可协议\u003C\u002Fb\u003E进行许可。\u003C\u002Fp\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cfigure data-size=\"normal\"\u003E\u003Cnoscript\u003E\u003Cimg src=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e839c50dedeb1edeb114d7a259c9ab80_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"276\" data-rawheight=\"320\" class=\"content_image\" width=\"276\"\u002F\u003E\u003C\u002Fnoscript\u003E\u003Cimg src=\"data:image\u002Fsvg+xml;utf8,&lt;svg xmlns=&#39;http:\u002F\u002Fwww.w3.org\u002F2000\u002Fsvg&#39; width=&#39;276&#39; height=&#39;320&#39;&gt;&lt;\u002Fsvg&gt;\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"276\" data-rawheight=\"320\" class=\"content_image lazy\" width=\"276\" data-actualsrc=\"https:\u002F\u002Fpic1.zhimg.com\u002Fv2-e839c50dedeb1edeb114d7a259c9ab80_b.jpg\"\u002F\u003E\u003C\u002Ffigure\u003E\u003Cp class=\"ztext-empty-paragraph\"\u003E\u003Cbr\u002F\u003E\u003C\u002Fp\u003E\u003Cp\u003E\u003Cb\u003E关注本公众号“微月人话”（ID：man-mind）\u003C\u002Fb\u003E，回复DNS，获取：\u003C\u002Fp\u003E\u003Cp\u003E1、作者制作的DNS原理及攻击介绍PPT，用于培训讲解。\u003C\u002Fp\u003E\u003Cp\u003E2、Kaminsky在Black Hat上的关于这次攻击的演讲PPT。\u003C\u002Fp\u003E","adminClosedComment":false,"topics":[{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19581904","type":"topic","id":"19581904","name":"DNS"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19577410","type":"topic","id":"19577410","name":"DNS 劫持"},{"url":"https:\u002F\u002Fwww.zhihu.com\u002Fapi\u002Fv4\u002Ftopics\u002F19819717","type":"topic","id":"19819717","name":"DNS 解析"}],"voteupCount":69,"voting":0,"heavyUpStatus":"allow_heavy_up","column":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1145396270574198784","id":"c_1145396270574198784","articlesCount":13,"acceptSubmission":true,"title":"关于人和科技的思考","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1145396270574198784","commentPermission":"all","created":1565863751,"updated":1591347181,"imageUrl":"https:\u002F\u002Fpic2.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c.jpg?source=172ae18b","uid":"41454500052992","userType":"people","isFollowing":false,"urlToken":"wang-ming-12-38","id":"a6c818a0336f8eb90960198fdd1db7f0","description":"","name":"卫sir","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002Fa6c818a0336f8eb90960198fdd1db7f0","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":36,"type":"column"},"commentCount":14,"contributions":[{"id":22301806,"state":"accepted","type":"first_publish","column":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1145396270574198784","id":"c_1145396270574198784","articlesCount":13,"acceptSubmission":true,"title":"关于人和科技的思考","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1145396270574198784","commentPermission":"all","created":1565863751,"updated":1591347181,"imageUrl":"https:\u002F\u002Fpic2.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c.jpg?source=172ae18b","uid":"41454500052992","userType":"people","isFollowing":false,"urlToken":"wang-ming-12-38","id":"a6c818a0336f8eb90960198fdd1db7f0","description":"","name":"卫sir","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002Fa6c818a0336f8eb90960198fdd1db7f0","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":36,"type":"column"}}],"isTitleImageFullScreen":false,"upvotedFollowees":[],"commercialInfo":{"isCommercial":false,"plugin":{}},"suggestEdit":{"status":false,"reason":"","tip":"","url":"","title":""},"reason":"","annotationAction":[],"canTip":false,"tipjarorsCount":0,"isLabeled":false,"hasPublishingDraft":false,"isFavorited":false,"favlistsCount":75,"isNormal":true,"status":0,"shareText":"一次出人意料而名留青史的DNS投毒攻击 - 来自知乎专栏「关于人和科技的思考」，作者: 卫sir https:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F92899876 （想看更多？下载 @知乎 App：http:\u002F\u002Fweibo.com\u002Fp\u002F100404711598 ）","canComment":{"status":true,"reason":""},"mcnFpShow":-1,"isVisible":true,"isLiked":false,"likedCount":19,"hasColumn":true,"republishers":[],"isNewLinkCard":true,"emojiReaction":{"cryFaceCount":0,"cryFaceHasSet":false,"hugCount":0,"hugHasSet":false,"likeCount":19,"likeHasSet":false,"onlookerCount":0,"onlookerHasSet":false},"attachedInfo":"kgIjCgkxMDg3NzM2NTMSCDkyODk5ODc2GAciCklNQUdFX1RFWFQ=","settings":{"tableOfContents":{"enabled":false}}}},"columns":{"c_1145396270574198784":{"description":"","canManage":false,"intro":"","isFollowing":false,"urlToken":"c_1145396270574198784","id":"c_1145396270574198784","articlesCount":13,"acceptSubmission":true,"title":"关于人和科技的思考","url":"https:\u002F\u002Fzhuanlan.zhihu.com\u002Fc_1145396270574198784","commentPermission":"all","created":1565863751,"updated":1591347181,"imageUrl":"https:\u002F\u002Fpic2.zhimg.com\u002F4b70deef7_720w.jpg?source=172ae18b","author":{"isFollowed":false,"avatarUrlTemplate":"https:\u002F\u002Fpica.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c.jpg?source=172ae18b","uid":"41454500052992","userType":"people","isFollowing":false,"urlToken":"wang-ming-12-38","id":"a6c818a0336f8eb90960198fdd1db7f0","description":"","name":"卫sir","isAdvertiser":false,"headline":"","gender":1,"url":"\u002Fpeople\u002Fa6c818a0336f8eb90960198fdd1db7f0","avatarUrl":"https:\u002F\u002Fpic2.zhimg.com\u002Fv2-e80f923f1a8564f080805aeb00d0b55c_l.jpg?source=172ae18b","isOrg":false,"type":"people"},"followers":36,"type":"column"}},"topics":{},"roundtables":{},"favlists":{},"comments":{},"notifications":{},"ebooks":{},"activities":{},"feeds":{},"pins":{},"promotions":{},"drafts":{},"chats":{},"posts":{},"clubs":{},"clubTags":{},"zvideos":{},"zvideoContributions":{}},"currentUser":"","account":{"lockLevel":{},"unlockTicketStatus":false,"unlockTicket":null,"challenge":[],"errorStatus":false,"message":"","isFetching":false,"accountInfo":{},"urlToken":{"loading":false},"cardUserInfo":{"vipInfo":{}},"handleWidget":{},"widgetList":[],"userWidgetId":""},"settings":{"socialBind":null,"inboxMsg":null,"notification":{},"email":{},"privacyFlag":null,"blockedUsers":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"blockedFollowees":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"ignoredTopics":{"isFetching":false,"paging":{"pageNo":1,"pageSize":6},"data":[]},"restrictedTopics":null,"laboratory":{}},"notification":{},"people":{"profileStatus":{},"activitiesByUser":{},"answersByUser":{},"answersSortByVotesByUser":{},"answersIncludedByUser":{},"votedAnswersByUser":{},"thankedAnswersByUser":{},"voteAnswersByUser":{},"thankAnswersByUser":{},"topicAnswersByUser":{},"zvideosByUser":{},"articlesByUser":{},"articlesSortByVotesByUser":{},"articlesIncludedByUser":{},"pinsByUser":{},"questionsByUser":{},"commercialQuestionsByUser":{},"favlistsByUser":{},"followingByUser":{},"followersByUser":{},"mutualsByUser":{},"followingColumnsByUser":{},"followingQuestionsByUser":{},"followingFavlistsByUser":{},"followingTopicsByUser":{},"publicationsByUser":{},"columnsByUser":{},"allFavlistsByUser":{},"brands":null,"creationsByUser":{},"creationsSortByVotesByUser":{},"creationsFeed":{},"infinity":{},"batchUsers":{},"profileInfinity":null},"env":{"ab":{"config":{"experiments":[{"expId":"launch-qa_cl_guest-2","expPrefix":"qa_cl_guest","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_andplay_d-2","expPrefix":"vd_andplay_d","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_hookupplay_an-2","expPrefix":"vd_hookupplay_an","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_timeguide-2","expPrefix":"vd_timeguide","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_video_replay-3","expPrefix":"vd_video_replay","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-vd_zvideo_link-10","expPrefix":"vd_zvideo_link","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"launch-zanswer-2","expPrefix":"zanswer","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"vd_bullet_gui-1","expPrefix":"vd_bullet_gui","isDynamicallyUpdated":true,"isRuntime":false,"includeTriggerInfo":false},{"expId":"PC_login-3_v6","expPrefix":"PC_login","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"account_sdk-2_v19","expPrefix":"account_sdk","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"se_guess_hot-3_v5","expPrefix":"se_guess_hot","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false},{"expId":"explore_newbee-2_v2","expPrefix":"explore_newbee","isDynamicallyUpdated":false,"isRuntime":false,"includeTriggerInfo":false}],"params":[{"id":"explore_newbee","type":"Int","value":"0","chainId":"_gene_","layerId":"explore_newbee","key":930},{"id":"zvideocard","type":"Int","value":"0","chainId":"_gene_","layerId":"zvideocard","key":1321},{"id":"ge_prf_rec","type":"String","value":"0","chainId":"_gene_","layerId":"getop_layer_991","key":3040},{"id":"gue_bullet_guide","type":"String","value":"发个弹幕聊聊…","layerId":"guevd_layer_0"},{"id":"gue_andplayd","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"vdox_cmt","type":"Int","value":"0","layerId":"l-9YBb"},{"id":"io_video_tab","type":"Int","value":"0","chainId":"_gene_","layerId":"io_video_tab","key":728},{"id":"se_simclick","type":"Int","value":"0","chainId":"_gene_","layerId":"se_simclick","key":1507},{"id":"ge_emoji","type":"String","value":"0","chainId":"_gene_","layerId":"getp_layer_827","key":3209},{"id":"tp_contents","type":"String","value":"2","chainId":"_all_","layerId":"tptp_layer_627"},{"id":"userlinkv2","type":"Int","value":"0","layerId":"userlinkv2"},{"id":"webpImg","type":"Int","value":"1","layerId":"JnVt"},{"id":"explore_b","type":"Int","value":"0","chainId":"_gene_","layerId":"explore_b","key":1257},{"id":"se_v_rescore_ab","type":"Int","value":"0","chainId":"_gene_","layerId":"se_v_rescore_ab","key":1330},{"id":"use_bff_profit","type":"Int","value":"0","layerId":"use_bff_profit"},{"id":"se_v_rank_ab","type":"Int","value":"0","chainId":"_gene_","layerId":"se_v_rank_ab","key":1035},{"id":"explore_b_opt","type":"Int","value":"0","chainId":"_gene_","layerId":"explore_b_opt","key":1297},{"id":"se_aaaa_new","type":"Int","value":"0","chainId":"_gene_","layerId":"se_aaaa_new","key":1365},{"id":"gue_goods_card","type":"String","value":"0","layerId":"gueqa_layer_1"},{"id":"gue_card_test","type":"String","value":"1","layerId":"gueqa_layer_2"},{"id":"gue_art2qa","type":"String","value":"0","layerId":"gueqa_layer_579"},{"id":"gue_recmess","type":"String","value":"0","layerId":"gueqa_layer_795"},{"id":"PC_login","type":"Int","value":"2","layerId":"PC_login"},{"id":"gue_video_replay","type":"String","value":"2","layerId":"guevd_layer_3"},{"id":"next_autoplay","type":"Int","value":"0","layerId":"l-next_autoplay"},{"id":"show_ad","type":"Int","value":"0","chainId":"_gene_","layerId":"show_ad","key":27},{"id":"se_financial","type":"Int","value":"0","chainId":"_gene_","layerId":"se_financial","key":1111},{"id":"edu_search_20","type":"Int","value":"0","chainId":"_gene_","layerId":"c6Il","key":1300},{"id":"web_login","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"gue_video_guide","type":"String","value":"1","layerId":"guevd_layer_625"},{"id":"ts_refresh","type":"Int","value":"1","layerId":"EBn6"},{"id":"gue_visit_n_artcard","type":"String","value":"1","layerId":"gueqa_layer_579"},{"id":"zr_slotpaidexp","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_5"},{"id":"ge_meta_ss","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_834","key":3079},{"id":"gue_sharp","type":"String","value":"1","layerId":"guevd_layer_686"},{"id":"se_video_expand","type":"Int","value":"0","chainId":"_gene_","layerId":"se_video_expand","key":1457},{"id":"edu_cd1","type":"Int","value":"0","layerId":"l-l18Y"},{"id":"explore_fl_pic","type":"Int","value":"0","layerId":"explore_fl_pic"},{"id":"plus_panel","type":"Int","value":"0","chainId":"_gene_","layerId":"2CDt","key":818},{"id":"share_content","type":"Int","value":"0","chainId":"_gene_","layerId":"share_content","key":1238},{"id":"se_shopguide","type":"Int","value":"0","chainId":"_gene_","layerId":"se_shopguide","key":1361},{"id":"ge_rec_2th","type":"String","value":"11","chainId":"_gene_","layerId":"geli_layer_965","key":3023},{"id":"web_answerlist_ad","type":"String","value":"0","layerId":"webqa_layer_1"},{"id":"test_rec","type":"Int","value":"10","layerId":"test_rec"},{"id":"ge_dipin_pre","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_1000","key":3124},{"id":"pc_editorplugin","type":"Int","value":"0","layerId":"pc_editorplugin"},{"id":"club_fn","type":"Int","value":"1","layerId":"club_fn"},{"id":"pfd_newbie","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie","key":63},{"id":"account_sdk","type":"Int","value":"2","chainId":"_gene_","layerId":"account_sdk","key":810},{"id":"se_rel_boost","type":"Int","value":"0","chainId":"_gene_","layerId":"se_rel_boost","key":1233},{"id":"se_aihuida","type":"Int","value":"0","chainId":"_gene_","layerId":"se_aihuida","key":1242},{"id":"SEM_Dynamic","type":"Int","value":"90","layerId":"SEM_Dynamic"},{"id":"rec_new2th","type":"Int","value":"0","chainId":"_gene_","layerId":"Hump","key":320},{"id":"recnew_2th","type":"Int","value":"24","chainId":"_gene_","layerId":"l-recnew_2th","key":67},{"id":"se_zhiplus_ec","type":"Int","value":"0","chainId":"_gene_","layerId":"se_zhiplus_ec","key":1511},{"id":"hwtj_bottom_btn","type":"Int","value":"1","layerId":"l-jrhg"},{"id":"rec_3th","type":"Int","value":"11","chainId":"_gene_","layerId":"pRqt","key":697},{"id":"se_zhiplus_ecpm","type":"Int","value":"0","chainId":"_gene_","layerId":"mr6i","key":855},{"id":"android_serial","type":"Int","value":"0","chainId":"_gene_","layerId":"android_serial","key":929},{"id":"fe_test","type":"Int","value":"0","chainId":"_gene_","layerId":"fe_test","key":1075},{"id":"web_sem_ab","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"qap_question_author","type":"String","value":"0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"qap_question_visitor","type":"String","value":" 0","chainId":"_all_","layerId":"qapqa_layer_2"},{"id":"h5_signin","type":"Int","value":"0","layerId":"h5_signin"},{"id":"official_info","type":"Int","value":"1","chainId":"_gene_","layerId":"official_info","key":1251},{"id":"vanswer_new","type":"Int","value":"0","chainId":"_gene_","layerId":"vanswer_new","key":1420},{"id":"gue_fo_recom","type":"String","value":"0","layerId":"gueqa_layer_780"},{"id":"ge_newcard","type":"String","value":"3","chainId":"_gene_","layerId":"geus_layer_839","key":2997},{"id":"andserial","type":"Int","value":"0","chainId":"_gene_","layerId":"CAxI","key":711},{"id":"Full_ans_fav","type":"Int","value":"0","chainId":"_gene_","layerId":"Pnd6","key":372},{"id":"upgrade_popup","type":"Int","value":"0","layerId":"upgrade_popup"},{"id":"Re_Collection","type":"Int","value":"0","chainId":"_gene_","layerId":"9olk","key":847},{"id":"se_v_new_table","type":"Int","value":"0","chainId":"_gene_","layerId":"eo6o","key":1016},{"id":"se_videobox","type":"Int","value":"0","chainId":"_gene_","layerId":"se_videobox","key":1248},{"id":"se_downgrade","type":"Int","value":"0","chainId":"_gene_","layerId":"LXXf","key":1458},{"id":"gue_art_ui","type":"String","value":"0","layerId":"gueqa_layer_647"},{"id":"zr_expslotpaid","type":"String","value":"1","chainId":"_all_","layerId":"zrrec_layer_11"},{"id":"ge_infinity6","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_815","key":2817},{"id":"ts_cardtitle","type":"Int","value":"0","layerId":"l-ZED7"},{"id":"pf_adjust","type":"String","value":"0","chainId":"_all_","layerId":"pfus_layer_9"},{"id":"comment","type":"Int","value":"0","chainId":"_gene_","layerId":"comment","key":644},{"id":"secondary_tab","type":"Int","value":"0","chainId":"_gene_","layerId":"secondary_tab","key":1011},{"id":"se_proxi2","type":"Int","value":"0","chainId":"_gene_","layerId":"cfX3","key":1090},{"id":"se_nwh_v2","type":"Int","value":"0","chainId":"_gene_","layerId":"se_nwh_v2","key":1366},{"id":"se_videobox_","type":"Int","value":"0","chainId":"_gene_","layerId":"se_videobox_","key":1408},{"id":"pf_noti_entry_num","type":"String","value":"0","chainId":"_all_","layerId":"pfus_layer_718"},{"id":"ad_com_zhi","type":"Int","value":"0","chainId":"_gene_","layerId":"ad_com_zhi","key":571},{"id":"se_zp_qt","type":"Int","value":"0","chainId":"_gene_","layerId":"se_zp_qt","key":1474},{"id":"se_video_second","type":"Int","value":"0","chainId":"_gene_","layerId":"se_video_second","key":1496},{"id":"web_collection_guest","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"gue_zvideo_link","type":"String","value":"1","layerId":"guevd_layer_2"},{"id":"office_xp","type":"Int","value":"1111","layerId":"office_xp"},{"id":"qa_coti_cotn","type":"Int","value":"0","chainId":"_gene_","layerId":"qa_coti_cotn","key":1347},{"id":"ge_yuzhi_v1","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1029","key":3127},{"id":"tp_topic_style","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"tp_zrec","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_619"},{"id":"ge_newyanzhi","type":"String","value":"0","chainId":"_gene_","layerId":"geus_layer_1019","key":2788},{"id":"PCplayingspeed","type":"Int","value":"0","layerId":"PCplayingspeed"},{"id":"iosserial","type":"Int","value":"0","chainId":"_gene_","layerId":"m7Id","key":714},{"id":"an_video_tab","type":"Int","value":"0","chainId":"_gene_","layerId":"an_video_tab","key":727},{"id":"gue_repost","type":"String","value":"1","layerId":"gueqa_layer_671"},{"id":"web_answer_list_ad","type":"String","value":"1","layerId":"webqa_layer_4"},{"id":"ge_search_ui","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_838","key":2898},{"id":"hw_aa_50","type":"Int","value":"0","chainId":"_gene_","layerId":"hw_aa_50","key":362},{"id":"ge_newbie3","type":"Int","value":"0","chainId":"_gene_","layerId":"ge_newbie3","key":180},{"id":"hw_aa_30","type":"Int","value":"0","chainId":"_gene_","layerId":"hw_aa_30","key":361},{"id":"private_vanswer","type":"Int","value":"0","chainId":"_gene_","layerId":"private_vanswer","key":951},{"id":"se_must_rank","type":"Int","value":"0","chainId":"_gene_","layerId":"nF45","key":1331},{"id":"web_audit_01","type":"String","value":"case1","layerId":"webre_layer_1"},{"id":"gue_playh_an","type":"String","value":"1","layerId":"guevd_layer_622"},{"id":"gue_bulletmb","type":"String","value":"0","layerId":"guevd_layer_812"},{"id":"new_ques_rec","type":"Int","value":"1","layerId":"i1NO"},{"id":"meta_ebook","type":"Int","value":"0","layerId":"meta_ebook"},{"id":"tp_dingyue_video","type":"String","value":"0","chainId":"_all_","layerId":"tptp_layer_4"},{"id":"web_richcontent","type":"Int","value":"0","layerId":"nXdw"},{"id":"km_detail_knn","type":"Int","value":"0","layerId":"l-TY59"},{"id":"se_zhiplus_cpc","type":"Int","value":"0","chainId":"_gene_","layerId":"se_zhiplus_cpc","key":716},{"id":"book_ebook","type":"Int","value":"0","chainId":"_gene_","layerId":"book_ebook","key":758},{"id":"se_guess_hot","type":"Int","value":"1","chainId":"_gene_","layerId":"1nGW","key":882},{"id":"se_scholar_tab","type":"Int","value":"0","chainId":"_gene_","layerId":"se_scholar_tab","key":1034},{"id":"qa_recmd_zvideo","type":"Int","value":"0","chainId":"_gene_","layerId":"fzT4","key":1190},{"id":"se_title_bst","type":"Int","value":"0","chainId":"_gene_","layerId":"2Avz","key":1294},{"id":"Test_Punk","type":"Int","value":"0","layerId":"Test_Punk"},{"id":"ge_sxzx","type":"String","value":"0","chainId":"_gene_","layerId":"gere_layer_990","key":3060},{"id":"ge_item","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_945","key":2971},{"id":"gue_v_serial","type":"String","value":"1","layerId":"guevd_layer_695"},{"id":"gue_iosplay","type":"String","value":"0","layerId":"guevd_layer_810"},{"id":"se_lingxi","type":"Int","value":"0","chainId":"_gene_","layerId":"se_lingxi","key":1298},{"id":"pfd_newbie2","type":"Int","value":"0","chainId":"_gene_","layerId":"pfd_newbie2","key":71},{"id":"se_images","type":"Int","value":"0","chainId":"_gene_","layerId":"ulTc","key":652},{"id":"book_kpwz","type":"Int","value":"0","chainId":"_gene_","layerId":"Zyox","key":671},{"id":"ge_video","type":"String","value":"0","chainId":"_gene_","layerId":"geli_layer_856","key":2831},{"id":"web_column_auto_invite","type":"String","value":"0","layerId":"webqa_layer_1"},{"id":"pc_arti_rebulid","type":"Int","value":"0","layerId":"pc_arti_rebulid"},{"id":"And_Collection","type":"Int","value":"0","chainId":"_gene_","layerId":"VbMB","key":848},{"id":"se_hw_search","type":"Int","value":"0","chainId":"_gene_","layerId":"bKV1","key":1093},{"id":"se_pa_n","type":"Int","value":"0","chainId":"_gene_","layerId":"959o","key":1301},{"id":"web_scl_rec","type":"String","value":"0","layerId":"webgw_layer_759"},{"id":"ge_guess","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_938","key":2912},{"id":"ffzix_xgdzwz","type":"Int","value":"0","layerId":"ffzix_xgdzwz"},{"id":"explore_all","type":"Int","value":"0","chainId":"_gene_","layerId":"explore_all","key":1076},{"id":"mixer_monetize","type":"Int","value":"0","chainId":"_gene_","layerId":"mixer_monetize","key":1335},{"id":"se_ffzx_jushen1","type":"String","value":"0","chainId":"_all_","layerId":"sese_layer_4"},{"id":"top_test_4_liguangyi","type":"String","value":"1","chainId":"_all_","layerId":"iosus_layer_1"},{"id":"gue_bullet_second","type":"String","value":"1","layerId":"guevd_layer_1"},{"id":"h5_open","type":"Int","value":"0","layerId":"h5_open"},{"id":"art_next_video","type":"Int","value":"0","chainId":"_gene_","layerId":"art_next_video","key":1305},{"id":"se_searchfilter","type":"Int","value":"0","chainId":"_gene_","layerId":"se_searchfilter","key":1438},{"id":"gue_q_share","type":"String","value":"0","layerId":"gueqa_layer_647"},{"id":"ge_sug_rep","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_1034","key":3158},{"id":"gue_profile_video","type":"String","value":"1","layerId":"guevd_layer_5"},{"id":"haowushangpin","type":"Int","value":"0","chainId":"_gene_","layerId":"haowushangpin","key":1217},{"id":"se_edu","type":"Int","value":"0","chainId":"_gene_","layerId":"va37","key":1124},{"id":"se_must_rerank","type":"Int","value":"0","chainId":"_gene_","layerId":"se_must_rerank","key":1362},{"id":"ge_hard_s_ma","type":"String","value":"0","chainId":"_gene_","layerId":"geli_layer_856","key":3031},{"id":"ge_usercard1","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_742","key":2740},{"id":"editor","type":"Int","value":"0","layerId":"editor"},{"id":"PC_blockLogin","type":"Int","value":"0","layerId":"PC_blockLogin"},{"id":"i_secondary_tab","type":"Int","value":"0","chainId":"_gene_","layerId":"i_secondary_tab","key":1012},{"id":"web_heifetz_grow_ad","type":"String","value":"1","layerId":"webgw_layer_3"},{"id":"ge_relation2","type":"String","value":"1","chainId":"_gene_","layerId":"gese_layer_815","key":2796},{"id":"xuanpinab","type":"Int","value":"0","layerId":"xuanpinab"},{"id":"i_choosy","type":"Int","value":"0","chainId":"_gene_","layerId":"i_choosy","key":1164},{"id":"a_choosy","type":"Int","value":"0","chainId":"_gene_","layerId":"a_choosy","key":1165},{"id":"gue_vid_tab","type":"String","value":"0","layerId":"guevd_layer_900"},{"id":"zanswer","type":"Int","value":"1","layerId":"l-zanswer"},{"id":"se_labelid1924","type":"Int","value":"0","chainId":"_gene_","layerId":"se_labelid1924","key":1141},{"id":"ge_entity","type":"String","value":"0","chainId":"_gene_","layerId":"gese_layer_946","key":3036},{"id":"iserial","type":"Int","value":"0","chainId":"_gene_","layerId":"iserial","key":928},{"id":"gue_cdzixun","type":"String","value":"0","layerId":"gueqa_layer_3"},{"id":"se_anti_cheat","type":"Int","value":"0","chainId":"_gene_","layerId":"se_anti_cheat","key":1407},{"id":"new_video_ans","type":"Int","value":"0","chainId":"_gene_","layerId":"new_video_ans","key":1419},{"id":"gue_messrec","type":"String","value":"0","layerId":"gueqa_layer_769"},{"id":"test_3","type":"Int","value":"0","chainId":"_gene_","layerId":"dABe","key":637}],"chains":[{"chainId":"_all_"}],"encodedParams":"CsQBogMpBeAL2ALjBYkM6QQyBQsEEQVVBRsAVwQUBQcMsQUyA9YEUQXPCzQMPwAqA9EE2gRAAUMA5wW5AlcDoQMzBOMEjAW1C8cCdAFPA\u002FgD4ASyBQELhALzA0IEVgWABTsCwgXYBUMFNwzkCsoC1wJSC2oBtABpAbcDMwXMAvYCcgMKBKYEDgX0C5sLEgVHAIwCnwIPC1ADRQQVBWALNAQ3BRkFngVWDMEEZARSBdcLtAr0A+wKjASNBHUE3AugA38FiwV9AhJiAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAIAAAAYAAsAAAABAAMAAAAAAAAAAAAAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAABAAAAAAAAAAA="},"triggers":{}},"userAgent":{"Edge":false,"IE":false,"Wechat":false,"Weibo":false,"QQ":false,"MQQBrowser":false,"Qzone":false,"Mobile":false,"Android":false,"iOS":false,"isAppleDevice":false,"Zhihu":false,"ZhihuHybrid":false,"isBot":false,"Tablet":false,"UC":false,"Sogou":false,"Qihoo":false,"Baidu":false,"BaiduApp":false,"Safari":false,"GoogleBot":false,"AndroidDaily":false,"iOSDaily":false,"WxMiniProgram":false,"BaiduMiniProgram":false,"QQMiniProgram":false,"JDMiniProgram":false,"isWebView":false,"isMiniProgram":false,"origin":"Mozilla\u002F5.0 (Windows NT 10.0; Win64; x64) AppleWebKit\u002F537.36 (KHTML, like Gecko) Chrome\u002F94.0.4606.81 Safari\u002F537.36"},"appViewConfig":{},"ctx":{"path":"\u002Fp\u002F92899876","query":{},"href":"http:\u002F\u002Fzhuanlan.zhihu.com\u002Fp\u002F92899876","host":"zhuanlan.zhihu.com"},"trafficSource":"production","edition":{"beijing":false,"baidu":false,"sogou":false,"baiduBeijing":false,"sogouBeijing":false,"sogouInput":false,"baiduSearch":false,"googleSearch":false,"shenma":false,"miniProgram":false,"xiaomi":false},"theme":"light","appHeaderTheme":{"current":"normal","disable":true,"normal":{"bgColor":"GBK99A"},"custom":{"bgColor":"GBK99A"}},"enableShortcut":true,"referer":"","xUDId":"AIDQRtqr8BOPTnK4urSICK4G6JWGuHXurUc=","mode":"ssr","conf":{},"xTrafficFreeOrigin":"","ipInfo":{"cityName":"上海","countryName":"中国","regionName":"上海","countryCode":"CN"},"logged":false,"vars":{"passThroughHeaders":{}}},"me":{"columnContributions":[]},"label":{"recognizerLists":{}},"ecommerce":{},"comments":{"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"parent":{}},"commentsV2":{"stickers":[],"commentWithPicPermission":{},"notificationsComments":{},"pagination":{},"collapsed":{},"reverse":{},"reviewing":{},"conversation":{},"conversationMore":{},"parent":{}},"pushNotifications":{"default":{"isFetching":false,"isDrained":false,"ids":[]},"follow":{"isFetching":false,"isDrained":false,"ids":[]},"vote_thank":{"isFetching":false,"isDrained":false,"ids":[]},"currentTab":"default","notificationsCount":{"default":0,"follow":0,"vote_thank":0}},"messages":{"data":{},"currentTab":"common","messageCount":0},"register":{"registerValidateSucceeded":null,"registerValidateErrors":{},"registerConfirmError":null,"sendDigitsError":null,"registerConfirmSucceeded":null},"login":{"loginUnregisteredError":false,"loginBindWechatError":false,"loginConfirmError":null,"sendDigitsError":null,"needSMSIdentify":false,"validateDigitsError":false,"loginConfirmSucceeded":null,"qrcodeLoginToken":"","qrcodeLoginScanStatus":0,"qrcodeLoginError":null,"qrcodeLoginReturnNewToken":false},"switches":{},"captcha":{"captchaNeeded":false,"captchaValidated":false,"captchaBase64String":null,"captchaValidationMessage":null,"loginCaptchaExpires":false},"sms":{"supportedCountries":[]},"chat":{"chats":{},"inbox":{"recents":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"strangers":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"friends":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"search":{"isFetching":false,"isDrained":false,"isPrevDrained":false,"result":[],"next":null,"key":null},"config":{"newCount":0,"strangerMessageSwitch":false,"strangerMessageUnread":false,"friendCount":0}},"global":{"isChatMqttExisted":false}},"emoticons":{"emoticonGroupList":[],"emoticonGroupDetail":{}},"creator":{"currentCreatorUrlToken":null,"homeData":{"recommendQuestions":[]},"tools":{"question":{"invitationCount":{"questionFolloweeCount":0,"questionTotalCount":0},"goodatTopics":[]},"customPromotion":{"itemLists":{}},"recommend":{"recommendTimes":{}}},"explore":{"academy":{"tabs":[],"article":{}}},"rights":[],"rightsStatus":{},"levelUpperLimit":10,"account":{"growthLevel":{}},"mcn":{},"applyStatus":{},"videoSupport":{},"mcnManage":{},"tasks":{},"recentlyCreated":[],"analysis":{"all":{},"answer":{},"zvideo":{},"article":{},"pin":{},"singleContent":{}},"announcement":{},"bannerList":[],"school":{"tabs":[],"contents":[],"banner":null,"entities":{}},"creatorsRecommendInfo":{},"menusShowControlByServer":{"bVipRecomend":false,"creationRelationship":false}},"answers":{"voters":{},"copyrightApplicants":{},"favlists":{},"newAnswer":{},"concernedUpvoters":{},"simpleConcernedUpvoters":{},"paidContent":{},"settings":{}},"recommendation":{"homeRecommendations":[]},"shareTexts":{},"articles":{"voters":{},"concernedUpvoters":{}},"previewPost":{},"favlists":{"relations":{}},"columns":{"voters":{}},"reward":{"answer":{},"article":{},"question":{}},"video":{"data":{},"shareVideoDetail":{},"last":{}},"topstory":{"recommend":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"follow":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"room":{"meta":{},"isFetching":false,"afterId":0,"items":[],"next":null},"followWonderful":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"sidebar":null,"announcement":{},"hotListCategories":[],"hotList":[],"guestFeeds":{"isFetching":false,"isDrained":false,"afterId":0,"items":[],"next":null},"followExtra":{"isNewUser":null,"isFetched":false,"followCount":0,"followers":[]},"hotDaily":{"data":[],"paging":{}},"hotHighlight":{"isFetching":false,"isDrained":false,"data":[],"paging":{}},"banner":{},"video":{"items":[],"next":null,"isLoading":false,"isDrained":false}},"readStatus":{},"column":{},"requestColumn":{"categories":[],"error":null},"articleContribution":{"contributeRequests":[],"deleteContributeIdList":[],"handledContributeIdList":[],"recommendedColumns":[],"pinnedColumns":[],"sentContributeRequestsIdList":[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"c_1145396270574198784"]},"columnContribution":{"contributeRequests":[],"autoInviteEnabled":false,"recommendedContributors":[],"contributionInvitation":null},"draftHistory":{"history":{},"drafts":{}},"upload":{},"articleDraft":{"titleImage":"","titleImageSize":{},"isTitleImageFullScreen":false,"canTitleImageFullScreen":false,"title":"","titleImageUploading":false,"error":"","content":"","draftLoading":false,"updating":false,"globalLoading":false,"pendingVideo":{"resource":null,"error":null},"deleteFail":{"fail":false},"recommendTopics":[],"selectedColumn":0,"articleDisclaimers":[]},"articleDrafts":{"isDrained":false,"isLoading":false,"items":[]},"columnAutocomplete":{"users":[],"friends":[]},"columnCollection":{},"userProfit":{"permission":{"permissionStatus":{"zhiZixuan":0,"recommend":-1,"task":0,"plugin":0,"infinity":0},"visible":false}},"mcn":{"bindInfo":{},"memberCategoryList":[],"producerList":[],"categoryList":[],"lists":{},"banners":{},"protocolStatus":{"isAgreedNew":true,"isAgreedOld":true},"probationCountdownDays":0},"zvideos":{"campaignVideoList":{},"campaigns":{},"tagoreCategory":[],"recommendations":{},"insertable":{},"recruit":{"form":{"platform":"","nickname":"","followerCount":"","domain":"","contact":""},"submited":false,"ranking":[]},"club":{},"qyActivityData":{},"talkActivityData":{},"batchVideos":{},"contribution":{"selectedContribution":null,"campaign":null,"configs":{},"contributionLists":{},"recommendQuestions":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]},"questionSearchResults":{"isLoading":true,"paging":{"isEnd":false,"isStart":true,"totals":0},"data":[]}},"creationReferences":{},"zvideoCollection":{},"zvideoGrant":{},"collectData":{"isFetching":false,"list":[]}},"republish":{}},"fetchHost":"www.zhihu.com","subAppName":"column"}</script><script crossorigin="" src="https://static.zhihu.com/heifetz/vendor.361d6298269aaf7ec23f.js"></script><script crossorigin="" src="https://static.zhihu.com/heifetz/column.app.6c9e44e28de004983cd0.js"></script></body><script src="https://hm.baidu.com/hm.js?98beee57fd2ef70ccdd5ca52b9740c49" async=""></script></html>
